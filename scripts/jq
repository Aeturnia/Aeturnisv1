#!/usr/bin/env node
// jq wrapper using node-jq

const { run } = require('node-jq');
const fs = require('fs');

const args = process.argv.slice(2);
const filter = args[0] || '.';
const file = args[1];

async function runJq() {
  try {
    let input;
    if (file && file !== '-') {
      input = fs.readFileSync(file, 'utf8');
    } else {
      // Read from stdin
      input = '';
      process.stdin.setEncoding('utf8');
      for await (const chunk of process.stdin) {
        input += chunk;
      }
    }

    const options = {
      input: 'string',
      output: 'string'
    };

    const result = await run(filter, input, options);
    process.stdout.write(result);
  } catch (error) {
    console.error(error.message);
    process.exit(1);
  }
}

runJq();