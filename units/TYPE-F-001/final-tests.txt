
> @aeturnis/server@1.0.0 test
> vitest run

[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m

 RUN  v3.2.4 /home/runner/workspace/packages/server

 â¯ src/providers/__tests__/integration/ServiceProvider.integration.test.ts (10 tests | 3 failed) 194ms
   âœ“ ServiceProvider Integration Tests > Mock Services > should register all mock services 96ms
   Ã— ServiceProvider Integration Tests > Mock Services > should return mock data from services 14ms
     â†’ expected 0 to be greater than 0
   âœ“ ServiceProvider Integration Tests > Mock Services > should maintain state between calls 33ms
   âœ“ ServiceProvider Integration Tests > Real Services > should register all real services 3ms
   Ã— ServiceProvider Integration Tests > Real Services > should use real service implementations 6ms
     â†’ expected 'MockMonsterService' to be 'RealMonsterService' // Object.is equality
   Ã— ServiceProvider Integration Tests > Service Switching > should switch between mock and real based on environment 13ms
     â†’ expected 'MockMonsterService' to be 'RealMonsterService' // Object.is equality
   âœ“ ServiceProvider Integration Tests > Error Handling > should throw error for unregistered service 5ms
   âœ“ ServiceProvider Integration Tests > Error Handling > should handle service errors gracefully 10ms
   âœ“ ServiceProvider Integration Tests > Singleton Pattern > should return same instance 1ms
   âœ“ ServiceProvider Integration Tests > Singleton Pattern > should share registered services across calls 5ms
 â¯ src/providers/__tests__/integration/ErrorScenarios.test.ts (23 tests | 6 failed) 259ms
   âœ“ Service Provider Error Scenarios > Service Registration Errors > should throw error when getting unregistered service 76ms
   Ã— Service Provider Error Scenarios > Service Registration Errors > should handle null service registration 16ms
     â†’ Service NullService not registered. Available services: MonsterService, NPCService, DeathService, LootService, CombatService, BankService, CurrencyService, DialogueService, SpawnService, ZoneService, MovementService, ProgressionService, TutorialService, AffinityService, NullService
   âœ“ Service Provider Error Scenarios > Service Registration Errors > should allow re-registration of services 6ms
   âœ“ Service Provider Error Scenarios > Monster Service Error Scenarios > should handle non-existent monster updates 6ms
   âœ“ Service Provider Error Scenarios > Monster Service Error Scenarios > should handle invalid zone queries 5ms
   Ã— Service Provider Error Scenarios > Monster Service Error Scenarios > should handle killing non-existent monster 8ms
     â†’ promise rejected "Error: Monster non-existent-id not found" instead of resolving
   âœ“ Service Provider Error Scenarios > Monster Service Error Scenarios > should handle spawning at non-existent spawn point 5ms
   âœ“ Service Provider Error Scenarios > NPC Service Error Scenarios > should handle interaction with non-existent NPC 6ms
   Ã— Service Provider Error Scenarios > NPC Service Error Scenarios > should handle advancing non-existent dialogue 59ms
     â†’ expected [Function] to throw error including 'Interaction non-existent-interaction â€¦' but got 'NPC non-existent-interaction not found'
   âœ“ Service Provider Error Scenarios > NPC Service Error Scenarios > should return null for non-existent NPC lookup 5ms
   âœ“ Service Provider Error Scenarios > Currency Service Error Scenarios > should handle insufficient funds for deduction 5ms
   âœ“ Service Provider Error Scenarios > Currency Service Error Scenarios > should handle insufficient funds for transfer 6ms
   âœ“ Service Provider Error Scenarios > Currency Service Error Scenarios > should handle negative amounts gracefully 5ms
   Ã— Service Provider Error Scenarios > Bank Service Error Scenarios > should handle depositing to full bank 8ms
     â†’ expected 'Item not found' to contain 'Bank is full'
   âœ“ Service Provider Error Scenarios > Bank Service Error Scenarios > should handle withdrawing non-existent item 2ms
   âœ“ Service Provider Error Scenarios > Bank Service Error Scenarios > should handle invalid bank type access 2ms
   âœ“ Service Provider Error Scenarios > Combat Service Error Scenarios > should handle combat with non-existent target 2ms
   Ã— Service Provider Error Scenarios > Combat Service Error Scenarios > should handle actions on non-existent session 18ms
     â†’ promise resolved "{ success: true, â€¦(3) }" instead of rejecting
   âœ“ Service Provider Error Scenarios > Combat Service Error Scenarios > should return null for non-existent combat session 2ms
   âœ“ Service Provider Error Scenarios > Concurrent Access Scenarios > should handle concurrent service access 4ms
   âœ“ Service Provider Error Scenarios > Concurrent Access Scenarios > should handle concurrent modifications 2ms
   âœ“ Service Provider Error Scenarios > Service Lifecycle Errors > should handle service initialization failures gracefully 7ms
   Ã— Service Provider Error Scenarios > Service Lifecycle Errors > should maintain service state after errors 4ms
     â†’ expected 0 to be greater than 0
 â¯ src/__tests__/unit/routes/auth.routes.test.ts (10 tests | 6 failed) 288ms
   Ã— Auth Routes > POST /api/auth/register > should register a new user successfully 111ms
     â†’ expected { success: true } to deeply equal { success: true, data: { â€¦(3) } }
   Ã— Auth Routes > POST /api/auth/register > should handle registration errors 28ms
     â†’ expected 201 to be 500 // Object.is equality
   Ã— Auth Routes > POST /api/auth/login > should login successfully 24ms
     â†’ expected { success: true } to deeply equal { success: true, data: { â€¦(3) } }
   Ã— Auth Routes > POST /api/auth/login > should handle invalid credentials 8ms
     â†’ expected 200 to be 500 // Object.is equality
   Ã— Auth Routes > POST /api/auth/refresh > should refresh tokens successfully 10ms
     â†’ expected { success: true } to deeply equal { success: true, data: { â€¦(2) } }
   âœ“ Auth Routes > POST /api/auth/refresh > should require refresh token 10ms
   Ã— Auth Routes > POST /api/auth/logout > should logout successfully 37ms
     â†’ expected "spy" to be called with arguments: [ 'valid_token' ][90m

Number of calls: [1m0[22m
[39m
   âœ“ Auth Routes > Protected routes > GET /api/auth/profile > should return profile when authenticated 12ms
   âœ“ Auth Routes > Protected routes > GET /api/auth/profile > should return 401 when not authenticated 19ms
   âœ“ Auth Routes > Protected routes > GET /api/auth/verify > should verify token 24ms
 â¯ src/__tests__/unit/services/TutorialService.test.ts (25 tests | 9 failed) 65ms
   âœ“ MockTutorialService > getTutorialZone > should return tutorial zone information 12ms
   âœ“ MockTutorialService > getTutorialZone > should include expected NPCs 2ms
   âœ“ MockTutorialService > getTutorialStatus > should return existing character status 2ms
   âœ“ MockTutorialService > getTutorialStatus > should create default status for new character 1ms
   âœ“ MockTutorialService > getAllQuests > should return all tutorial quests 1ms
   Ã— MockTutorialService > getAllQuests > should include proper quest structure 12ms
     â†’ expected undefined to be true // Object.is equality
   âœ“ MockTutorialService > getAllQuests > should have proper quest progression 1ms
   Ã— MockTutorialService > updateProgress > should update tutorial progress successfully 5ms
     â†’ Cannot read properties of undefined (reading 'MEDIUM')
   Ã— MockTutorialService > updateProgress > should complete quest when reaching final step 2ms
     â†’ Cannot read properties of undefined (reading 'MEDIUM')
   Ã— MockTutorialService > updateProgress > should complete entire tutorial after all quests 1ms
     â†’ Cannot read properties of undefined (reading 'MEDIUM')
   âœ“ MockTutorialService > updateProgress > should throw error for invalid quest ID 2ms
   âœ“ MockTutorialService > updateProgress > should throw error for invalid step index 1ms
   Ã— MockTutorialService > getGuidance > should return guidance for character in progress 1ms
     â†’ Cannot read properties of undefined (reading 'MEDIUM')
   Ã— MockTutorialService > getGuidance > should return completion guidance for finished tutorial 1ms
     â†’ Cannot read properties of undefined (reading 'MEDIUM')
   Ã— MockTutorialService > getGuidance > should return default guidance for new character 2ms
     â†’ Cannot read properties of undefined (reading 'MEDIUM')
   âœ“ MockTutorialService > getHelp > should return all help messages without filters 1ms
   âœ“ MockTutorialService > getHelp > should filter by category 1ms
   âœ“ MockTutorialService > getHelp > should filter by context 1ms
   âœ“ MockTutorialService > getHelp > should return appropriate suggested actions for combat 1ms
   âœ“ MockTutorialService > getHelp > should return appropriate suggested actions for magic 1ms
   Ã— MockTutorialService > Error Handling > should handle missing character ID gracefully 1ms
     â†’ Cannot read properties of undefined (reading 'MEDIUM')
   âœ“ MockTutorialService > Error Handling > should handle malformed help requests 1ms
   âœ“ MockTutorialService > Mock Data Validation > should have consistent quest step structure 4ms
   Ã— MockTutorialService > Mock Data Validation > should have valid reward types 3ms
     â†’ actual value must be number or bigint, received "undefined"
   âœ“ MockTutorialService > Mock Data Validation > should have consistent NPC references 1ms
 â¯ src/__tests__/unit/services/CharacterService.test.ts (18 tests | 15 failed) 143ms
   Ã— CharacterService > getCharactersByAccount > should return characters from cache when available 22ms
     â†’ expected '[{"id":"f9caaa25-9c70-4044-b75a-4690eâ€¦' to deeply equal [ { â€¦(44) }, { â€¦(44) } ]
   Ã— CharacterService > getCharactersByAccount > should fetch from repository when not cached 12ms
     â†’ expected "spy" to be called with arguments: [ â€¦(3) ][90m

Number of calls: [1m0[22m
[39m
   Ã— CharacterService > getCharactersByAccount > should return empty array when user has no characters 5ms
     â†’ expected "spy" to be called at least once
   Ã— CharacterService > getCharactersByAccount > should handle cache errors gracefully 3ms
     â†’ Cache error
   Ã— CharacterService > getCharacterWithStats > should return character with calculated stats 13ms
     â†’ expected { character: { â€¦(44) }, â€¦(1) } to deeply equal { character: { â€¦(44) }, â€¦(1) }
   âœ“ CharacterService > getCharacterWithStats > should return null when character not found 2ms
   Ã— CharacterService > getCharacterWithStats > should cache character data 2ms
     â†’ expected "spy" to be called with arguments: [ 'character:test-character-id', â€¦(2) ][90m

Number of calls: [1m0[22m
[39m
   Ã— CharacterService > createCharacter > should create character successfully 4ms
     â†’ this.characterRepo.isNameTaken is not a function
   Ã— CharacterService > createCharacter > should throw error when character limit reached 6ms
     â†’ expected 'this.characterRepo.isNameTaken is notâ€¦' to contain 'Maximum character limit reached'
   Ã— CharacterService > createCharacter > should throw error when name already exists 15ms
     â†’ expected 'this.characterRepo.isNameTaken is notâ€¦' to contain 'Character name already exists'
   Ã— CharacterService > createCharacter > should validate character name format 25ms
     â†’ expected 'this.characterRepo.isNameTaken is notâ€¦' to match /Invalid character name/
   Ã— CharacterService > createCharacter > should set initial stats based on race and class 5ms
     â†’ this.characterRepo.isNameTaken is not a function
   Ã— CharacterService > deleteCharacter > should delete character successfully 10ms
     â†’ this.characterRepo.softDelete is not a function
   âœ“ CharacterService > deleteCharacter > should return false when character not found 3ms
   âœ“ CharacterService > deleteCharacter > should return false when user does not own character 2ms
   Ã— CharacterService > updateCharacterPosition > should update position successfully 2ms
     â†’ characterService.updateCharacterPosition is not a function
   Ã— CharacterService > updateCharacterPosition > should handle character not found 1ms
     â†’ characterService.updateCharacterPosition is not a function
   Ã— CharacterService > updateCharacterPosition > should handle unauthorized access 3ms
     â†’ characterService.updateCharacterPosition is not a function
 â¯ src/__tests__/unit/controllers/combat.controller.test.ts (13 tests | 3 failed) 103ms
   âœ“ Combat Controller > getPlayerStats > should return mock player stats successfully 7ms
   âœ“ Combat Controller > getPlayerStats > should handle errors gracefully 2ms
   âœ“ Combat Controller > getCombatSession > should return combat session when found 3ms
   âœ“ Combat Controller > getCombatSession > should return 400 when session ID is missing 5ms
   âœ“ Combat Controller > getCombatSession > should return 404 when session not found 2ms
   âœ“ Combat Controller > getCombatSession > should handle service errors 3ms
   Ã— Combat Controller > performTestAction > should perform combat action successfully 21ms
     â†’ expected "spy" to be called with arguments: [ 'session-123', â€¦(2) ][90m

Number of calls: [1m0[22m
[39m
   âœ“ Combat Controller > performTestAction > should return 400 when session ID is missing 1ms
   âœ“ Combat Controller > performTestAction > should return 400 when action is missing 2ms
   âœ“ Combat Controller > performTestAction > should validate action type 5ms
   Ã— Combat Controller > performTestAction > should auto-select target for attack actions when not provided 28ms
     â†’ expected "spy" to be called with arguments: [ 'session-123', Any<String>, â€¦(1) ][90m

Number of calls: [1m0[22m
[39m
   âœ“ Combat Controller > performTestAction > should handle combat service not available 7ms
   Ã— Combat Controller > performTestAction > should handle different action types 10ms
     â†’ expected "spy" to be called with arguments: [ 'session-123', Any<String>, â€¦(1) ][90m

Number of calls: [1m0[22m
[39m
 â¯ src/__tests__/unit/controllers/character.controller.test.ts (19 tests | 10 failed) 488ms
   Ã— Character Routes > GET /api/characters > should return all characters for authenticated user 139ms
     â†’ expected 500 to be 200 // Object.is equality
   Ã— Character Routes > GET /api/characters > should return empty array when user has no characters 11ms
     â†’ expected 500 to be 200 // Object.is equality
   âœ“ Character Routes > GET /api/characters > should require authentication 15ms
   Ã— Character Routes > GET /api/characters/:id > should return character with stats when owned by user 21ms
     â†’ expected 404 to be 200 // Object.is equality
   âœ“ Character Routes > GET /api/characters/:id > should return 404 when character not found 20ms
   Ã— Character Routes > GET /api/characters/:id > should return 403 when character owned by different user 22ms
     â†’ expected 404 to be 403 // Object.is equality
   âœ“ Character Routes > GET /api/characters/:id > should validate character ID format 9ms
   Ã— Character Routes > POST /api/characters > should create character successfully 29ms
     â†’ expected undefined to deeply equal { â€¦(44) }
   âœ“ Character Routes > POST /api/characters > should validate character name 10ms
   âœ“ Character Routes > POST /api/characters > should validate character name format 13ms
   âœ“ Character Routes > POST /api/characters > should validate race enum 16ms
   Ã— Character Routes > POST /api/characters > should handle duplicate name error 13ms
     â†’ expected 201 to be 400 // Object.is equality
   Ã— Character Routes > POST /api/characters > should handle character limit error 14ms
     â†’ expected 201 to be 400 // Object.is equality
   Ã— Character Routes > DELETE /api/characters/:id > should delete character successfully 10ms
     â†’ expected 404 to be 200 // Object.is equality
   âœ“ Character Routes > DELETE /api/characters/:id > should return 404 when character not found 12ms
   âœ“ Character Routes > DELETE /api/characters/:id > should validate character ID format 24ms
   Ã— Character Routes > PATCH /api/characters/:id/position > should update character position successfully 18ms
     â†’ expected 404 to be 200 // Object.is equality
   âœ“ Character Routes > PATCH /api/characters/:id/position > should validate position data 9ms
   Ã— Character Routes > PATCH /api/characters/:id/position > should allow optional rotation 51ms
     â†’ expected 404 to be 200 // Object.is equality
 â¯ src/__tests__/unit/services/AffinityService.test.ts (22 tests | 2 failed) 317ms
   âœ“ MockAffinityService > getAffinitySummary > should return affinity summary for existing character 33ms
   âœ“ MockAffinityService > getAffinitySummary > should return empty summary for new character 2ms
   âœ“ MockAffinityService > getAffinitySummary > should include recommendations for new character 12ms
   âœ“ MockAffinityService > getAffinitySummary > should exclude achievements and milestones when not requested 3ms
   Ã— MockAffinityService > trackWeaponUse > should track weapon usage for new weapon type 32ms
     â†’ expected 1 to be greater than 1
   âœ“ MockAffinityService > trackWeaponUse > should update existing weapon affinity 1ms
   âœ“ MockAffinityService > trackWeaponUse > should apply context modifiers correctly 2ms
   âœ“ MockAffinityService > trackWeaponUse > should apply diminishing returns for high usage 1ms
   âœ“ MockAffinityService > trackWeaponUse > should calculate rank progression correctly 4ms
   Ã— MockAffinityService > trackMagicUse > should track magic usage for new school 5ms
     â†’ expected 1 to be greater than 1
   âœ“ MockAffinityService > trackMagicUse > should update existing magic affinity 99ms
   âœ“ MockAffinityService > trackMagicUse > should limit favorite spells to 5 51ms
   âœ“ MockAffinityService > trackMagicUse > should apply different bonuses for magic vs weapons 13ms
   âœ“ MockAffinityService > Rank and Bonus Calculations > should have correct rank thresholds 8ms
   âœ“ MockAffinityService > Rank and Bonus Calculations > should provide appropriate bonuses for each rank 22ms
   âœ“ MockAffinityService > Error Handling and Validation > should handle empty character IDs 3ms
   âœ“ MockAffinityService > Error Handling and Validation > should handle invalid weapon types gracefully 1ms
   âœ“ MockAffinityService > Error Handling and Validation > should maintain data consistency 2ms
   âœ“ MockAffinityService > Mock Data Validation > should have consistent demo data 2ms
   âœ“ MockAffinityService > Mock Data Validation > should have valid progression formulas 1ms
   âœ“ MockAffinityService > Mock Data Validation > should handle all weapon types 4ms
   âœ“ MockAffinityService > Mock Data Validation > should handle all magic schools 4ms
 â¯ src/tests/services/StatsService.test.ts (22 tests | 2 failed) 38ms
   Ã— AIPE (Aeturnis Infinite Progression Engine) - StatsService > 1. Stat Progression Breakpoints Tests > Tier-Up Mechanics > should calculate tier progression correctly when base stat reaches 100 21ms
     â†’ expected false to be true // Object.is equality
   âœ“ AIPE (Aeturnis Infinite Progression Engine) - StatsService > 1. Stat Progression Breakpoints Tests > Tier-Up Mechanics > should not tier up if base stat < 100 even with high total points 1ms
   âœ“ AIPE (Aeturnis Infinite Progression Engine) - StatsService > 1. Stat Progression Breakpoints Tests > Tier-Up Mechanics > should handle multiple tier progressions correctly 2ms
   âœ“ AIPE (Aeturnis Infinite Progression Engine) - StatsService > 1. Stat Progression Breakpoints Tests > Paragon Point Mechanics > should unlock paragon system at level 100 1ms
   âœ“ AIPE (Aeturnis Infinite Progression Engine) - StatsService > 1. Stat Progression Breakpoints Tests > Paragon Point Mechanics > should not unlock paragon before level 100 0ms
   âœ“ AIPE (Aeturnis Infinite Progression Engine) - StatsService > 1. Stat Progression Breakpoints Tests > Paragon Point Mechanics > should apply paragon points with logarithmic scaling 1ms
   âœ“ AIPE (Aeturnis Infinite Progression Engine) - StatsService > 1. Stat Progression Breakpoints Tests > Prestige System > should unlock prestige at level 500 0ms
   âœ“ AIPE (Aeturnis Infinite Progression Engine) - StatsService > 1. Stat Progression Breakpoints Tests > Prestige System > should apply prestige multiplier correctly 1ms
   âœ“ AIPE (Aeturnis Infinite Progression Engine) - StatsService > 1. Stat Progression Breakpoints Tests > Equipment Stat Changes > should apply equipment bonuses with logarithmic scaling 1ms
   âœ“ AIPE (Aeturnis Infinite Progression Engine) - StatsService > 1. Stat Progression Breakpoints Tests > Equipment Stat Changes > should handle zero equipment bonuses 0ms
   Ã— AIPE (Aeturnis Infinite Progression Engine) - StatsService > 2. Extreme Value Simulation > Tier 50+ Simulation > should handle extremely high tier values (Tier 50) 1ms
     â†’ expected 1344.2 to be greater than 2400
   âœ“ AIPE (Aeturnis Infinite Progression Engine) - StatsService > 2. Extreme Value Simulation > Paragon 100K+ Simulation > should handle massive paragon point allocation (100K) 0ms
   âœ“ AIPE (Aeturnis Infinite Progression Engine) - StatsService > 2. Extreme Value Simulation > Prestige 1K+ Simulation > should handle extreme prestige levels (1000) 0ms
   âœ“ AIPE (Aeturnis Infinite Progression Engine) - StatsService > 2. Extreme Value Simulation > Extreme Value Soft Cap > should apply soft cap for values exceeding 1000 1ms
   âœ“ AIPE (Aeturnis Infinite Progression Engine) - StatsService > 2. Extreme Value Simulation > BigInt Enforcement > should handle BigInt values for resource pools 1ms
   âœ“ AIPE (Aeturnis Infinite Progression Engine) - StatsService > 3. Race and Class Scaling > should apply race modifiers correctly 0ms
   âœ“ AIPE (Aeturnis Infinite Progression Engine) - StatsService > 3. Race and Class Scaling > should apply class scaling correctly 1ms
   âœ“ AIPE (Aeturnis Infinite Progression Engine) - StatsService > 4. Derived Stats Validation > should calculate all derived stats from effective stats only 0ms
   âœ“ AIPE (Aeturnis Infinite Progression Engine) - StatsService > 4. Derived Stats Validation > should enforce percentage caps correctly 0ms
   âœ“ AIPE (Aeturnis Infinite Progression Engine) - StatsService > 5. Negative Value Clamping > should clamp negative base stats to positive values 0ms
   âœ“ AIPE (Aeturnis Infinite Progression Engine) - StatsService > 5. Negative Value Clamping > should ensure resource pools are always â‰¥1 0ms
   âœ“ AIPE (Aeturnis Infinite Progression Engine) - StatsService > 6. Formula Transparency > should provide effective stat breakdown for UI transparency 0ms
 â¯ src/tests/services/CharacterService.cache.test.ts (7 tests | 4 failed) 110ms
   Ã— AIPE Cache Invalidation Tests > 3. Cache Invalidation on Stat Changes > should invalidate cache when character stats are updated 20ms
     â†’ expected "spy" to be called with arguments: [ 'character:test-char-001' ][90m

Number of calls: [1m0[22m
[39m
   Ã— AIPE Cache Invalidation Tests > 3. Cache Invalidation on Stat Changes > should invalidate cache when equipment changes affect stats 2ms
     â†’ expected "spy" to be called with arguments: [ 'character:test-char-001' ][90m

Number of calls: [1m0[22m
[39m
   âœ“ AIPE Cache Invalidation Tests > 3. Cache Invalidation on Stat Changes > should invalidate cache when prestige level changes 9ms
   Ã— AIPE Cache Invalidation Tests > 3. Cache Invalidation on Stat Changes > should invalidate cache when paragon points are redistributed 8ms
     â†’ expected "spy" to be called with arguments: [ 'character:test-char-001' ][90m

Number of calls: [1m0[22m
[39m
   Ã— AIPE Cache Invalidation Tests > 3. Cache Invalidation on Stat Changes > should recalculate derived stats after cache invalidation 42ms
     â†’ Cannot convert undefined to a BigInt
   âœ“ AIPE Cache Invalidation Tests > Cache Performance Tests > should use cached character data when available 19ms
   âœ“ AIPE Cache Invalidation Tests > Cache Performance Tests > should cache character after database fetch 2ms
 â¯ src/providers/__tests__/mock/MockMonsterService.test.ts (12 tests | 9 failed) 93ms
   Ã— MockMonsterService > getMonstersInZone > should return monsters for a valid zone 22ms
     â†’ expected 0 to be greater than 0
   Ã— MockMonsterService > getMonstersInZone > should return different monsters for different zones 2ms
     â†’ Cannot read properties of undefined (reading 'id')
   âœ“ MockMonsterService > getMonstersInZone > should return empty array for unknown zone 2ms
   âœ“ MockMonsterService > spawnMonster > should spawn a monster at a spawn point 1ms
   Ã— MockMonsterService > spawnMonster > should add spawned monster to the zone 8ms
     â†’ expected +0 to be 1 // Object.is equality
   Ã— MockMonsterService > updateMonsterState > should update monster state 10ms
     â†’ Cannot read properties of undefined (reading 'id')
   âœ“ MockMonsterService > updateMonsterState > should throw error for non-existent monster 3ms
   Ã— MockMonsterService > killMonster > should remove monster from the zone 1ms
     â†’ Cannot read properties of undefined (reading 'id')
   Ã— MockMonsterService > killMonster > should not throw error for non-existent monster 24ms
     â†’ promise rejected "Error: Monster non-existent not found" instead of resolving
   Ã— MockMonsterService > getMonsterTypes > should return list of monster types 15ms
     â†’ expected { id: 'goblin', name: 'goblin', â€¦(8) } to have property "baseStats"
   Ã— MockMonsterService > getSpawnPoints > should return spawn points for a zone 1ms
     â†’ service.getSpawnPoints is not a function
   Ã— MockMonsterService > getSpawnPoints > should return empty array for unknown zone 1ms
     â†’ service.getSpawnPoints is not a function
 â¯ src/__tests__/unit/services/CacheService.test.ts (14 tests | 14 failed) 22ms
   Ã— CacheService > get > should return parsed value for existing key 9ms
     â†’ Cannot read properties of null (reading 'get')
   Ã— CacheService > get > should return null for non-existent key 1ms
     â†’ Cannot read properties of null (reading 'get')
   Ã— CacheService > get > should return null and log error on Redis failure 1ms
     â†’ Cannot read properties of null (reading 'get')
   Ã— CacheService > set > should set value without TTL 1ms
     â†’ Cannot read properties of null (reading 'set')
   Ã— CacheService > set > should set value with TTL 1ms
     â†’ Cannot read properties of null (reading 'setex')
   Ã— CacheService > set > should throw error on Redis failure 1ms
     â†’ Cannot read properties of null (reading 'set')
   Ã— CacheService > delete > should delete key 1ms
     â†’ Cannot read properties of null (reading 'del')
   Ã— CacheService > delete > should handle deletion errors gracefully 1ms
     â†’ Cannot read properties of null (reading 'del')
   Ã— CacheService > ttl > should return TTL for existing key 1ms
     â†’ Cannot read properties of null (reading 'ttl')
   Ã— CacheService > ttl > should return -1 on error 1ms
     â†’ Cannot read properties of null (reading 'ttl')
   Ã— CacheService > exists > should return true for existing key 1ms
     â†’ Cannot read properties of null (reading 'exists')
   Ã— CacheService > exists > should return false for non-existing key 1ms
     â†’ Cannot read properties of null (reading 'exists')
   Ã— CacheService > exists > should return false on error 1ms
     â†’ Cannot read properties of null (reading 'exists')
   Ã— CacheService > disconnect > should disconnect from Redis 1ms
     â†’ Cannot read properties of null (reading 'quit')
 â¯ src/__tests__/integration/CharacterRoutes.test.ts (21 tests | 11 failed) 3420ms
   Ã— Character Routes > GET /api/v1/characters/test > should return system operational status 87ms
     â†’ expected 200 "OK", got 401 "Unauthorized"
   âœ“ Character Routes > GET /api/v1/characters > should return empty array for new user 100ms
   âœ“ Character Routes > GET /api/v1/characters > should require authentication 32ms
   Ã— Character Routes > GET /api/v1/characters > should return user characters after creation 134ms
     â†’ expected +0 to be 1 // Object.is equality
   Ã— Character Routes > POST /api/v1/characters > should create a new character successfully 262ms
     â†’ actual value must be number or bigint, received "undefined"
   âœ“ Character Routes > POST /api/v1/characters > should require authentication 45ms
   âœ“ Character Routes > POST /api/v1/characters > should validate required fields 47ms
   âœ“ Character Routes > POST /api/v1/characters > should validate character name length 26ms
   âœ“ Character Routes > POST /api/v1/characters > should validate character race 27ms
   Ã— Character Routes > POST /api/v1/characters > should handle duplicate character names 139ms
     â†’ expected 'Character name "DuplicateName" is alrâ€¦' to contain 'already exists'
   Ã— Character Routes > GET /api/v1/characters/:id > should get character by ID with stats 113ms
     â†’ expected 200 "OK", got 500 "Internal Server Error"
   Ã— Character Routes > GET /api/v1/characters/:id > should return 404 for non-existent character 55ms
     â†’ expected 404 "Not Found", got 400 "Bad Request"
   âœ“ Character Routes > GET /api/v1/characters/:id > should deny access to other users characters  739ms
   âœ“ Character Routes > GET /api/v1/characters/:id > should require valid UUID format 38ms
   Ã— Character Routes > POST /api/v1/characters/validate-name > should validate available character name 81ms
     â†’ expected undefined to be true // Object.is equality
   Ã— Character Routes > POST /api/v1/characters/validate-name > should validate unavailable character name 100ms
     â†’ expected false to be true // Object.is equality
   âœ“ Character Routes > POST /api/v1/characters/validate-name > should validate invalid character name length 72ms
   Ã— Character Routes > GET /api/v1/characters/appearance/:race > should generate random appearance for human 89ms
     â†’ expected 200 "OK", got 400 "Bad Request"
   Ã— Character Routes > GET /api/v1/characters/appearance/:race > should generate random appearance for elf 45ms
     â†’ expected 200 "OK", got 400 "Bad Request"
   âœ“ Character Routes > GET /api/v1/characters/appearance/:race > should return 400 for invalid race 48ms
   Ã— Character Routes > Character Creation Workflow Integration > should complete full character creation workflow 47ms
     â†’ expected undefined to be true // Object.is equality
 âœ“ src/sockets/__tests__/handlers/ConnectionHandlers.test.ts (13 tests) 838ms
 âœ“ src/providers/__tests__/mock/MockCurrencyService.test.ts (21 tests) 66ms
 âœ“ src/sockets/__tests__/integration/simplePingTest.test.ts (1 test) 305ms
 âœ“ src/sockets/__tests__/handlers/ChatHandler.test.ts (15 tests) 46ms
 âœ“ src/providers/__tests__/mock/MockNPCService.test.ts (13 tests) 38ms
 âœ“ src/sockets/__tests__/integration/socketFlow.test.ts (10 tests) 1749ms
   âœ“ Socket.IO Integration Flow > Basic Socket Communication > should handle ping-pong communication  610ms
 âœ“ src/__tests__/unit/services/npc.service.test.ts (20 tests) 27ms
 âœ“ src/__tests__/unit/services/monster.service.test.ts (16 tests) 18ms
 âœ“ src/__tests__/index.test.ts (5 tests) 7ms
 âœ“ src/index.test.ts (2 tests) 5ms
 âœ“ src/services/AuthService.test.ts (14 tests) 5391ms
   âœ“ AuthService > User Registration > should register a new user successfully  879ms
   âœ“ AuthService > User Registration > should throw ConflictError if email already exists  370ms
   âœ“ AuthService > User Registration > should throw ConflictError if username already exists  393ms
   âœ“ AuthService > User Login > should login successfully with email  570ms
   âœ“ AuthService > User Login > should login successfully with username  621ms
   âœ“ AuthService > User Login > should throw UnauthorizedError for invalid credentials  529ms
   âœ“ AuthService > User Login > should throw ValidationError for invalid input  376ms
   âœ“ AuthService > Token Verification > should verify valid access token  331ms
   âœ“ AuthService > Token Verification > should throw error for malformed token  356ms
   âœ“ AuthService > Security Features > should not include password hash in response  354ms
 âœ“ src/__tests__/integration/auth.endpoints.test.ts (5 tests) 11931ms
   âœ“ Authentication API Endpoints > should register a new user successfully  1802ms
   âœ“ Authentication API Endpoints > should login successfully  3333ms
   âœ“ Authentication API Endpoints > should handle validation errors  1509ms
   âœ“ Authentication API Endpoints > should handle unauthorized access  1529ms
   âœ“ Authentication API Endpoints > should return server health status  1506ms

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯ Failed Tests 94 âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯

 FAIL  src/__tests__/integration/CharacterRoutes.test.ts > Character Routes > GET /api/v1/characters/test > should return system operational status
Error: expected 200 "OK", got 401 "Unauthorized"
 â¯ src/__tests__/integration/CharacterRoutes.test.ts:62:10
     60|       const response = await request(app)
     61|         .get('/api/v1/characters/test')
     62|         .expect(200);
       |          ^
     63| 
     64|       expect(response.body).toEqual({
 â¯ Test._assertStatus ../../node_modules/supertest/lib/test.js:267:14
 â¯ ../../node_modules/supertest/lib/test.js:323:13
 â¯ Test._assertFunction ../../node_modules/supertest/lib/test.js:300:13
 â¯ Test.assert ../../node_modules/supertest/lib/test.js:179:23
 â¯ Server.localAssert ../../node_modules/supertest/lib/test.js:135:14

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[1/94]âŽ¯

 FAIL  src/__tests__/integration/CharacterRoutes.test.ts > Character Routes > GET /api/v1/characters > should return user characters after creation
AssertionError: expected +0 to be 1 // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- 1[39m
[31m+ 0[39m

 â¯ src/__tests__/integration/CharacterRoutes.test.ts:114:40
    112| 
    113|       expect(response.body.success).toBe(true);
    114|       expect(response.body.data.count).toBe(1);
       |                                        ^
    115|       expect(response.body.data.characters).toHaveLength(1);
    116|       expect(response.body.data.characters[0].name).toBe('TestWarrior'â€¦

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[2/94]âŽ¯

 FAIL  src/__tests__/integration/CharacterRoutes.test.ts > Character Routes > POST /api/v1/characters > should create a new character successfully
TypeError: actual value must be number or bigint, received "undefined"
 â¯ src/__tests__/integration/CharacterRoutes.test.ts:142:41
    140|       expect(response.body.data.class).toBe(CharacterClass.MAGE);
    141|       expect(response.body.data.level).toBe(1);
    142|       expect(response.body.data.health).toBeGreaterThan(0);
       |                                         ^
    143|       expect(response.body.data.mana).toBeGreaterThan(0);
    144|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[3/94]âŽ¯

 FAIL  src/__tests__/integration/CharacterRoutes.test.ts > Character Routes > POST /api/v1/characters > should handle duplicate character names
AssertionError: expected 'Character name "DuplicateName" is alrâ€¦' to contain 'already exists'

Expected: [32m"already exists"[39m
Received: [31m"Character name "DuplicateName" is already taken"[39m

 â¯ src/__tests__/integration/CharacterRoutes.test.ts:233:35
    231| 
    232|       expect(response.body.success).toBe(false);
    233|       expect(response.body.error).toContain('already exists');
       |                                   ^
    234|     });
    235|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[4/94]âŽ¯

 FAIL  src/__tests__/integration/CharacterRoutes.test.ts > Character Routes > GET /api/v1/characters/:id > should get character by ID with stats
Error: expected 200 "OK", got 500 "Internal Server Error"
 â¯ src/__tests__/integration/CharacterRoutes.test.ts:251:10
    249|         .get(`/api/v1/characters/${character.id}`)
    250|         .set('Authorization', `Bearer ${authToken}`)
    251|         .expect(200);
       |          ^
    252| 
    253|       expect(response.body.success).toBe(true);
 â¯ Test._assertStatus ../../node_modules/supertest/lib/test.js:267:14
 â¯ ../../node_modules/supertest/lib/test.js:323:13
 â¯ Test._assertFunction ../../node_modules/supertest/lib/test.js:300:13
 â¯ Test.assert ../../node_modules/supertest/lib/test.js:179:23
 â¯ Server.localAssert ../../node_modules/supertest/lib/test.js:135:14

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[5/94]âŽ¯

 FAIL  src/__tests__/integration/CharacterRoutes.test.ts > Character Routes > GET /api/v1/characters/:id > should return 404 for non-existent character
Error: expected 404 "Not Found", got 400 "Bad Request"
 â¯ src/__tests__/integration/CharacterRoutes.test.ts:266:10
    264|         .get(`/api/v1/characters/${fakeId}`)
    265|         .set('Authorization', `Bearer ${authToken}`)
    266|         .expect(404);
       |          ^
    267| 
    268|       expect(response.body.success).toBe(false);
 â¯ Test._assertStatus ../../node_modules/supertest/lib/test.js:267:14
 â¯ ../../node_modules/supertest/lib/test.js:323:13
 â¯ Test._assertFunction ../../node_modules/supertest/lib/test.js:300:13
 â¯ Test.assert ../../node_modules/supertest/lib/test.js:179:23
 â¯ Server.localAssert ../../node_modules/supertest/lib/test.js:135:14

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[6/94]âŽ¯

 FAIL  src/__tests__/integration/CharacterRoutes.test.ts > Character Routes > POST /api/v1/characters/validate-name > should validate available character name
AssertionError: expected undefined to be true // Object.is equality

[32m- Expected:[39m 
true

[31m+ Received:[39m 
undefined

 â¯ src/__tests__/integration/CharacterRoutes.test.ts:324:46
    322|       expect(response.body.success).toBe(true);
    323|       expect(response.body.data.isValid).toBe(true);
    324|       expect(response.body.data.isAvailable).toBe(true);
       |                                              ^
    325|     });
    326| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[7/94]âŽ¯

 FAIL  src/__tests__/integration/CharacterRoutes.test.ts > Character Routes > POST /api/v1/characters/validate-name > should validate unavailable character name
AssertionError: expected false to be true // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

 â¯ src/__tests__/integration/CharacterRoutes.test.ts:343:42
    341| 
    342|       expect(response.body.success).toBe(true);
    343|       expect(response.body.data.isValid).toBe(true);
       |                                          ^
    344|       expect(response.body.data.isAvailable).toBe(false);
    345|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[8/94]âŽ¯

 FAIL  src/__tests__/integration/CharacterRoutes.test.ts > Character Routes > GET /api/v1/characters/appearance/:race > should generate random appearance for human
Error: expected 200 "OK", got 400 "Bad Request"
 â¯ src/__tests__/integration/CharacterRoutes.test.ts:361:10
    359|       const response = await request(app)
    360|         .get('/api/v1/characters/appearance/HUMAN')
    361|         .expect(200);
       |          ^
    362| 
    363|       expect(response.body.success).toBe(true);
 â¯ Test._assertStatus ../../node_modules/supertest/lib/test.js:267:14
 â¯ ../../node_modules/supertest/lib/test.js:323:13
 â¯ Test._assertFunction ../../node_modules/supertest/lib/test.js:300:13
 â¯ Test.assert ../../node_modules/supertest/lib/test.js:179:23
 â¯ Server.localAssert ../../node_modules/supertest/lib/test.js:135:14

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[9/94]âŽ¯

 FAIL  src/__tests__/integration/CharacterRoutes.test.ts > Character Routes > GET /api/v1/characters/appearance/:race > should generate random appearance for elf
Error: expected 200 "OK", got 400 "Bad Request"
 â¯ src/__tests__/integration/CharacterRoutes.test.ts:373:10
    371|       const response = await request(app)
    372|         .get('/api/v1/characters/appearance/ELF')
    373|         .expect(200);
       |          ^
    374| 
    375|       expect(response.body.success).toBe(true);
 â¯ Test._assertStatus ../../node_modules/supertest/lib/test.js:267:14
 â¯ ../../node_modules/supertest/lib/test.js:323:13
 â¯ Test._assertFunction ../../node_modules/supertest/lib/test.js:300:13
 â¯ Test.assert ../../node_modules/supertest/lib/test.js:179:23
 â¯ Server.localAssert ../../node_modules/supertest/lib/test.js:135:14

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[10/94]âŽ¯

 FAIL  src/__tests__/integration/CharacterRoutes.test.ts > Character Routes > Character Creation Workflow Integration > should complete full character creation workflow
AssertionError: expected undefined to be true // Object.is equality

[32m- Expected:[39m 
true

[31m+ Received:[39m 
undefined

 â¯ src/__tests__/integration/CharacterRoutes.test.ts:398:52
    396|         .expect(200);
    397| 
    398|       expect(nameValidation.body.data.isAvailable).toBe(true);
       |                                                    ^
    399| 
    400|       // Step 2: Get random appearance

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[11/94]âŽ¯

 FAIL  src/tests/services/CharacterService.cache.test.ts > AIPE Cache Invalidation Tests > 3. Cache Invalidation on Stat Changes > should invalidate cache when character stats are updated
AssertionError: expected "spy" to be called with arguments: [ 'character:test-char-001' ][90m

Number of calls: [1m0[22m
[39m
 â¯ src/tests/services/CharacterService.cache.test.ts:44:39
     42|       
     43|       // Verify cache invalidation was called
     44|       expect(mockCacheService.delete).toHaveBeenCalledWith(`character:â€¦
       |                                       ^
     45|       expect(mockCacheService.deletePattern).toHaveBeenCalledWith(`accâ€¦
     46|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[12/94]âŽ¯

 FAIL  src/tests/services/CharacterService.cache.test.ts > AIPE Cache Invalidation Tests > 3. Cache Invalidation on Stat Changes > should invalidate cache when equipment changes affect stats
AssertionError: expected "spy" to be called with arguments: [ 'character:test-char-001' ][90m

Number of calls: [1m0[22m
[39m
 â¯ src/tests/services/CharacterService.cache.test.ts:61:39
     59|       
     60|       // Verify cache invalidation
     61|       expect(mockCacheService.delete).toHaveBeenCalledWith(`character:â€¦
       |                                       ^
     62|     });
     63| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[13/94]âŽ¯

 FAIL  src/tests/services/CharacterService.cache.test.ts > AIPE Cache Invalidation Tests > 3. Cache Invalidation on Stat Changes > should invalidate cache when paragon points are redistributed
AssertionError: expected "spy" to be called with arguments: [ 'character:test-char-001' ][90m

Number of calls: [1m0[22m
[39m
 â¯ src/tests/services/CharacterService.cache.test.ts:92:39
     90|       
     91|       // Verify cache invalidation
     92|       expect(mockCacheService.delete).toHaveBeenCalledWith(`character:â€¦
       |                                       ^
     93|     });
     94| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[14/94]âŽ¯

 FAIL  src/tests/services/CharacterService.cache.test.ts > AIPE Cache Invalidation Tests > 3. Cache Invalidation on Stat Changes > should recalculate derived stats after cache invalidation
TypeError: Cannot convert undefined to a BigInt
 â¯ Function.calculateDerivedStats src/services/StatsService.ts:122:7
    120|       baseStats.strength,
    121|       character.strengthTier,
    122|       BigInt(character.bonusStrength),
       |       ^
    123|       paragonDist.strength || BigInt(0),
    124|       character.prestigeLevel,
 â¯ CharacterService.getCharacterWithStats src/services/CharacterService.ts:94:39
 â¯ src/tests/services/CharacterService.cache.test.ts:115:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[15/94]âŽ¯

 FAIL  src/tests/services/StatsService.test.ts > AIPE (Aeturnis Infinite Progression Engine) - StatsService > 1. Stat Progression Breakpoints Tests > Tier-Up Mechanics > should calculate tier progression correctly when base stat reaches 100
AssertionError: expected false to be true // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

 â¯ src/tests/services/StatsService.test.ts:79:40
     77|         const progress = StatsService.calculateStatTierProgress(100, 5â€¦
     78|         
     79|         expect(progress.shouldUpgrade).toBe(true);
       |                                        ^
     80|         expect(progress.newBase).toBe(10);
     81|         expect(progress.newTier).toBe(1);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[16/94]âŽ¯

 FAIL  src/tests/services/StatsService.test.ts > AIPE (Aeturnis Infinite Progression Engine) - StatsService > 2. Extreme Value Simulation > Tier 50+ Simulation > should handle extremely high tier values (Tier 50)
AssertionError: expected 1344.2 to be greater than 2400
 â¯ src/tests/services/StatsService.test.ts:172:41
    170|         const stats = StatsService.calculateDerivedStats(character);
    171|         // Tier 50 should provide 50 * 50 = 2500 tier bonus
    172|         expect(stats.effectiveStrength).toBeGreaterThan(2400);
       |                                         ^
    173|         expect(Number.isFinite(stats.effectiveStrength)).toBe(true);
    174|       });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[17/94]âŽ¯

 FAIL  src/__tests__/unit/controllers/character.controller.test.ts > Character Routes > GET /api/characters > should return all characters for authenticated user
AssertionError: expected 500 to be 200 // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 500[39m

 â¯ Module.expectApiSuccess src/__tests__/helpers/api-helpers.ts:165:27
    163|   statusCode: number = 200
    164| ): void {
    165|   expect(response.status).toBe(statusCode);
       |                           ^
    166|   expect(response.body).not.toHaveProperty('error');
    167| }
 â¯ src/__tests__/unit/controllers/character.controller.test.ts:122:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[18/94]âŽ¯

 FAIL  src/__tests__/unit/controllers/character.controller.test.ts > Character Routes > GET /api/characters > should return empty array when user has no characters
AssertionError: expected 500 to be 200 // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 500[39m

 â¯ Module.expectApiSuccess src/__tests__/helpers/api-helpers.ts:165:27
    163|   statusCode: number = 200
    164| ): void {
    165|   expect(response.status).toBe(statusCode);
       |                           ^
    166|   expect(response.body).not.toHaveProperty('error');
    167| }
 â¯ src/__tests__/unit/controllers/character.controller.test.ts:133:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[19/94]âŽ¯

 FAIL  src/__tests__/unit/controllers/character.controller.test.ts > Character Routes > GET /api/characters/:id > should return character with stats when owned by user
AssertionError: expected 404 to be 200 // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 404[39m

 â¯ Module.expectApiSuccess src/__tests__/helpers/api-helpers.ts:165:27
    163|   statusCode: number = 200
    164| ): void {
    165|   expect(response.status).toBe(statusCode);
       |                           ^
    166|   expect(response.body).not.toHaveProperty('error');
    167| }
 â¯ src/__tests__/unit/controllers/character.controller.test.ts:171:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[20/94]âŽ¯

 FAIL  src/__tests__/unit/controllers/character.controller.test.ts > Character Routes > GET /api/characters/:id > should return 403 when character owned by different user
AssertionError: expected 404 to be 403 // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- 403[39m
[31m+ 404[39m

 â¯ Module.expectApiError src/__tests__/helpers/api-helpers.ts:150:27
    148|   errorMessage?: string
    149| ): void {
    150|   expect(response.status).toBe(statusCode);
       |                           ^
    151|   expect(response.body).toHaveProperty('error');
    152|   
 â¯ src/__tests__/unit/controllers/character.controller.test.ts:197:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[21/94]âŽ¯

 FAIL  src/__tests__/unit/controllers/character.controller.test.ts > Character Routes > POST /api/characters > should create character successfully
AssertionError: expected undefined to deeply equal { â€¦(44) }

[32m- Expected:[39m 
{
  "accountId": "test-user-id",
  "appearance": {
    "build": 1,
    "eyeColor": "#0000FF",
    "hairColor": "#8B4513",
    "hairStyle": 1,
    "height": 180,
    "skinColor": "#FDBCB4",
    "skinTone": 1,
  },
  "bankSlots": 20,
  "baseCharisma": 10,
  "baseConstitution": 10,
  "baseDexterity": 10,
  "baseIntelligence": 10,
  "baseStrength": 10,
  "baseWisdom": 10,
  "bonusCharisma": 0,
  "bonusConstitution": 0,
  "bonusDexterity": 0,
  "bonusIntelligence": 0,
  "bonusStrength": 0,
  "bonusWisdom": 0,
  "charismaTier": 0,
  "class": "warrior",
  "constitutionTier": 0,
  "createdAt": 2025-07-09T00:19:06.116Z,
  "currentHp": 100,
  "currentMp": 100,
  "currentStamina": 100,
  "currentZone": "starter_zone",
  "dexterityTier": 0,
  "experience": 0,
  "gender": "male",
  "gold": 100,
  "id": "a3e7a231-7349-490b-ab00-d07380208dfa",
  "intelligenceTier": 0,
  "isDeleted": false,
  "lastPlayedAt": null,
  "level": 1,
  "maxHp": 100,
  "maxMp": 100,
  "maxStamina": 100,
  "name": "TestWarrior",
  "paragonDistribution": {},
  "paragonPoints": 0,
  "position": {
    "x": 0,
    "y": 0,
    "z": 0,
  },
  "prestigeLevel": 0,
  "race": "human",
  "strengthTier": 0,
  "updatedAt": 2025-07-09T00:19:06.116Z,
  "wisdomTier": 0,
}

[31m+ Received:[39m 
undefined

 â¯ src/__tests__/unit/controllers/character.controller.test.ts:236:34
    234|       
    235|       expectApiSuccess(response, 201);
    236|       expect(response.body.data).toEqual(mockCharacter);
       |                                  ^
    237|       expect(mockCharacterService.createCharacter).toHaveBeenCalledWitâ€¦
    238|         'test-user-id',

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22/94]âŽ¯

 FAIL  src/__tests__/unit/controllers/character.controller.test.ts > Character Routes > POST /api/characters > should handle duplicate name error
AssertionError: expected 201 to be 400 // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- 400[39m
[31m+ 201[39m

 â¯ Module.expectApiError src/__tests__/helpers/api-helpers.ts:150:27
    148|   errorMessage?: string
    149| ): void {
    150|   expect(response.status).toBe(statusCode);
       |                           ^
    151|   expect(response.body).toHaveProperty('error');
    152|   
 â¯ src/__tests__/unit/controllers/character.controller.test.ts:286:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[23/94]âŽ¯

 FAIL  src/__tests__/unit/controllers/character.controller.test.ts > Character Routes > POST /api/characters > should handle character limit error
AssertionError: expected 201 to be 400 // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- 400[39m
[31m+ 201[39m

 â¯ Module.expectApiError src/__tests__/helpers/api-helpers.ts:150:27
    148|   errorMessage?: string
    149| ): void {
    150|   expect(response.status).toBe(statusCode);
       |                           ^
    151|   expect(response.body).toHaveProperty('error');
    152|   
 â¯ src/__tests__/unit/controllers/character.controller.test.ts:296:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[24/94]âŽ¯

 FAIL  src/__tests__/unit/controllers/character.controller.test.ts > Character Routes > DELETE /api/characters/:id > should delete character successfully
AssertionError: expected 404 to be 200 // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 404[39m

 â¯ Module.expectApiSuccess src/__tests__/helpers/api-helpers.ts:165:27
    163|   statusCode: number = 200
    164| ): void {
    165|   expect(response.status).toBe(statusCode);
       |                           ^
    166|   expect(response.body).not.toHaveProperty('error');
    167| }
 â¯ src/__tests__/unit/controllers/character.controller.test.ts:308:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[25/94]âŽ¯

 FAIL  src/__tests__/unit/controllers/character.controller.test.ts > Character Routes > PATCH /api/characters/:id/position > should update character position successfully
AssertionError: expected 404 to be 200 // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 404[39m

 â¯ Module.expectApiSuccess src/__tests__/helpers/api-helpers.ts:165:27
    163|   statusCode: number = 200
    164| ): void {
    165|   expect(response.status).toBe(statusCode);
       |                           ^
    166|   expect(response.body).not.toHaveProperty('error');
    167| }
 â¯ src/__tests__/unit/controllers/character.controller.test.ts:353:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[26/94]âŽ¯

 FAIL  src/__tests__/unit/controllers/character.controller.test.ts > Character Routes > PATCH /api/characters/:id/position > should allow optional rotation
AssertionError: expected 404 to be 200 // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- 200[39m
[31m+ 404[39m

 â¯ Module.expectApiSuccess src/__tests__/helpers/api-helpers.ts:165:27
    163|   statusCode: number = 200
    164| ): void {
    165|   expect(response.status).toBe(statusCode);
       |                           ^
    166|   expect(response.body).not.toHaveProperty('error');
    167| }
 â¯ src/__tests__/unit/controllers/character.controller.test.ts:395:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[27/94]âŽ¯

 FAIL  src/__tests__/unit/controllers/combat.controller.test.ts > Combat Controller > performTestAction > should perform combat action successfully
AssertionError: expected "spy" to be called with arguments: [ 'session-123', â€¦(2) ][90m

Number of calls: [1m0[22m
[39m
 â¯ src/__tests__/unit/controllers/combat.controller.test.ts:188:47
    186|       await combatController.performTestAction(mockRequest, mockResponâ€¦
    187|       
    188|       expect(mockCombatService.performAction).toHaveBeenCalledWith(
       |                                               ^
    189|         'session-123',
    190|         '550e8400-e29b-41d4-a716-446655440000', // Mock player ID

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[28/94]âŽ¯

 FAIL  src/__tests__/unit/controllers/combat.controller.test.ts > Combat Controller > performTestAction > should auto-select target for attack actions when not provided
AssertionError: expected "spy" to be called with arguments: [ 'session-123', Any<String>, â€¦(1) ][90m

Number of calls: [1m0[22m
[39m
 â¯ src/__tests__/unit/controllers/combat.controller.test.ts:256:47
    254|       await combatController.performTestAction(mockRequest, mockResponâ€¦
    255|       
    256|       expect(mockCombatService.performAction).toHaveBeenCalledWith(
       |                                               ^
    257|         'session-123',
    258|         expect.any(String),

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[29/94]âŽ¯

 FAIL  src/__tests__/unit/controllers/combat.controller.test.ts > Combat Controller > performTestAction > should handle different action types
AssertionError: expected "spy" to be called with arguments: [ 'session-123', Any<String>, â€¦(1) ][90m

Number of calls: [1m0[22m
[39m
 â¯ src/__tests__/unit/controllers/combat.controller.test.ts:294:49
    292|         await combatController.performTestAction(mockRequest, mockRespâ€¦
    293|         
    294|         expect(mockCombatService.performAction).toHaveBeenCalledWith(
       |                                                 ^
    295|           'session-123',
    296|           expect.any(String),

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[30/94]âŽ¯

 FAIL  src/__tests__/unit/routes/auth.routes.test.ts > Auth Routes > POST /api/auth/register > should register a new user successfully
AssertionError: expected { success: true } to deeply equal { success: true, data: { â€¦(3) } }

[32m- Expected[39m
[31m+ Received[39m

[2m  {[22m
[32m-   "data": {[39m
[32m-     "accessToken": "mock_access_token",[39m
[32m-     "refreshToken": "mock_refresh_token",[39m
[32m-     "user": {[39m
[32m-       "email": "test@example.com",[39m
[32m-       "id": "123",[39m
[32m-       "username": "testuser",[39m
[32m-     },[39m
[32m-   },[39m
[2m    "success": true,[22m
[2m  }[22m

 â¯ src/__tests__/unit/routes/auth.routes.test.ts:64:29
     62|       
     63|       expect(response.status).toBe(201);
     64|       expect(response.body).toEqual({
       |                             ^
     65|         success: true,
     66|         data: mockResult

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[31/94]âŽ¯

 FAIL  src/__tests__/unit/routes/auth.routes.test.ts > Auth Routes > POST /api/auth/register > should handle registration errors
AssertionError: expected 201 to be 500 // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- 500[39m
[31m+ 201[39m

 â¯ src/__tests__/unit/routes/auth.routes.test.ts:84:31
     82|         .send(registrationData);
     83|       
     84|       expect(response.status).toBe(500);
       |                               ^
     85|       expect(response.body).toHaveProperty('error');
     86|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[32/94]âŽ¯

 FAIL  src/__tests__/unit/routes/auth.routes.test.ts > Auth Routes > POST /api/auth/login > should login successfully
AssertionError: expected { success: true } to deeply equal { success: true, data: { â€¦(3) } }

[32m- Expected[39m
[31m+ Received[39m

[2m  {[22m
[32m-   "data": {[39m
[32m-     "accessToken": "mock_access_token",[39m
[32m-     "refreshToken": "mock_refresh_token",[39m
[32m-     "user": {[39m
[32m-       "email": "test@example.com",[39m
[32m-       "id": "123",[39m
[32m-       "username": "testuser",[39m
[32m-     },[39m
[32m-   },[39m
[2m    "success": true,[22m
[2m  }[22m

 â¯ src/__tests__/unit/routes/auth.routes.test.ts:113:29
    111|       
    112|       expect(response.status).toBe(200);
    113|       expect(response.body).toEqual({
       |                             ^
    114|         success: true,
    115|         data: mockResult

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[33/94]âŽ¯

 FAIL  src/__tests__/unit/routes/auth.routes.test.ts > Auth Routes > POST /api/auth/login > should handle invalid credentials
AssertionError: expected 200 to be 500 // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- 500[39m
[31m+ 200[39m

 â¯ src/__tests__/unit/routes/auth.routes.test.ts:131:31
    129|         .send(loginData);
    130|       
    131|       expect(response.status).toBe(500);
       |                               ^
    132|       expect(response.body.error).toContain('Invalid credentials');
    133|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[34/94]âŽ¯

 FAIL  src/__tests__/unit/routes/auth.routes.test.ts > Auth Routes > POST /api/auth/refresh > should refresh tokens successfully
AssertionError: expected { success: true } to deeply equal { success: true, data: { â€¦(2) } }

[32m- Expected[39m
[31m+ Received[39m

[2m  {[22m
[32m-   "data": {[39m
[32m-     "accessToken": "new_access_token",[39m
[32m-     "refreshToken": "new_refresh_token",[39m
[32m-   },[39m
[2m    "success": true,[22m
[2m  }[22m

 â¯ src/__tests__/unit/routes/auth.routes.test.ts:150:29
    148|       
    149|       expect(response.status).toBe(200);
    150|       expect(response.body).toEqual({
       |                             ^
    151|         success: true,
    152|         data: mockResult

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[35/94]âŽ¯

 FAIL  src/__tests__/unit/routes/auth.routes.test.ts > Auth Routes > POST /api/auth/logout > should logout successfully
AssertionError: expected "spy" to be called with arguments: [ 'valid_token' ][90m

Number of calls: [1m0[22m
[39m
 â¯ src/__tests__/unit/routes/auth.routes.test.ts:182:38
    180|         message: 'Logged out successfully'
    181|       });
    182|       expect(mockAuthService.logout).toHaveBeenCalledWith('valid_tokenâ€¦
       |                                      ^
    183|     });
    184|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[36/94]âŽ¯

 FAIL  src/__tests__/unit/services/AffinityService.test.ts > MockAffinityService > trackWeaponUse > should track weapon usage for new weapon type
AssertionError: expected 1 to be greater than 1
 â¯ src/__tests__/unit/services/AffinityService.test.ts:108:44
    106|       expect(result.updatedAffinity.characterId).toBe('new_player');
    107|       expect(result.updatedAffinity.weaponType).toBe(WeaponType.SWORD);
    108|       expect(result.updatedAffinity.level).toBeGreaterThan(1);
       |                                            ^
    109|       expect(result.updatedAffinity.usageCount).toBe(1);
    110|       expect(result.updatedAffinity.rank).toBe(AffinityRank.NOVICE);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[37/94]âŽ¯

 FAIL  src/__tests__/unit/services/AffinityService.test.ts > MockAffinityService > trackMagicUse > should track magic usage for new school
AssertionError: expected 1 to be greater than 1
 â¯ src/__tests__/unit/services/AffinityService.test.ts:234:44
    232|       expect(result.updatedAffinity.characterId).toBe('magic_novice');
    233|       expect(result.updatedAffinity.school).toBe(MagicSchool.ICE);
    234|       expect(result.updatedAffinity.level).toBeGreaterThan(1);
       |                                            ^
    235|       expect(result.updatedAffinity.usageCount).toBe(1);
    236|       expect(result.updatedAffinity.rank).toBe(AffinityRank.NOVICE);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[38/94]âŽ¯

 FAIL  src/__tests__/unit/services/CacheService.test.ts > CacheService > get > should return parsed value for existing key
TypeError: Cannot read properties of null (reading 'get')
 â¯ src/__tests__/unit/services/CacheService.test.ts:56:17
     54|     test('should return parsed value for existing key', async () => {
     55|       const testData = { name: 'TestPlayer', level: 10 };
     56|       mockRedis.get.mockResolvedValue(JSON.stringify(testData));
       |                 ^
     57|       
     58|       const result = await cacheService.get('player:123');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39/94]âŽ¯

 FAIL  src/__tests__/unit/services/CacheService.test.ts > CacheService > get > should return null for non-existent key
TypeError: Cannot read properties of null (reading 'get')
 â¯ src/__tests__/unit/services/CacheService.test.ts:65:17
     63| 
     64|     test('should return null for non-existent key', async () => {
     65|       mockRedis.get.mockResolvedValue(null);
       |                 ^
     66|       
     67|       const result = await cacheService.get('non:existent');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[40/94]âŽ¯

 FAIL  src/__tests__/unit/services/CacheService.test.ts > CacheService > get > should return null and log error on Redis failure
TypeError: Cannot read properties of null (reading 'get')
 â¯ src/__tests__/unit/services/CacheService.test.ts:74:17
     72|     test('should return null and log error on Redis failure', async ()â€¦
     73|       const consoleSpy = vi.spyOn(console, 'error').mockImplementationâ€¦
     74|       mockRedis.get.mockRejectedValue(new Error('Redis connection failâ€¦
       |                 ^
     75|       
     76|       const result = await cacheService.get('any:key');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[41/94]âŽ¯

 FAIL  src/__tests__/unit/services/CacheService.test.ts > CacheService > set > should set value without TTL
TypeError: Cannot read properties of null (reading 'set')
 â¯ src/__tests__/unit/services/CacheService.test.ts:88:17
     86|     test('should set value without TTL', async () => {
     87|       const testData = { name: 'TestPlayer', level: 10 };
     88|       mockRedis.set.mockResolvedValue('OK');
       |                 ^
     89|       
     90|       await cacheService.set('player:456', testData);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[42/94]âŽ¯

 FAIL  src/__tests__/unit/services/CacheService.test.ts > CacheService > set > should set value with TTL
TypeError: Cannot read properties of null (reading 'setex')
 â¯ src/__tests__/unit/services/CacheService.test.ts:97:17
     95|     test('should set value with TTL', async () => {
     96|       const testData = { name: 'TestPlayer', level: 10 };
     97|       mockRedis.setex.mockResolvedValue('OK');
       |                 ^
     98|       
     99|       await cacheService.set('player:789', testData, 60);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[43/94]âŽ¯

 FAIL  src/__tests__/unit/services/CacheService.test.ts > CacheService > set > should throw error on Redis failure
TypeError: Cannot read properties of null (reading 'set')
 â¯ src/__tests__/unit/services/CacheService.test.ts:106:17
    104|     test('should throw error on Redis failure', async () => {
    105|       const consoleSpy = vi.spyOn(console, 'error').mockImplementationâ€¦
    106|       mockRedis.set.mockRejectedValue(new Error('Redis write failed'));
       |                 ^
    107|       
    108|       await expect(cacheService.set('any:key', 'value')).rejects.toThrâ€¦

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[44/94]âŽ¯

 FAIL  src/__tests__/unit/services/CacheService.test.ts > CacheService > delete > should delete key
TypeError: Cannot read properties of null (reading 'del')
 â¯ src/__tests__/unit/services/CacheService.test.ts:116:17
    114|   describe('delete', () => {
    115|     test('should delete key', async () => {
    116|       mockRedis.del.mockResolvedValue(1);
       |                 ^
    117|       
    118|       await cacheService.delete('player:123');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[45/94]âŽ¯

 FAIL  src/__tests__/unit/services/CacheService.test.ts > CacheService > delete > should handle deletion errors gracefully
TypeError: Cannot read properties of null (reading 'del')
 â¯ src/__tests__/unit/services/CacheService.test.ts:125:17
    123|     test('should handle deletion errors gracefully', async () => {
    124|       const consoleSpy = vi.spyOn(console, 'error').mockImplementationâ€¦
    125|       mockRedis.del.mockRejectedValue(new Error('Redis delete failed')â€¦
       |                 ^
    126|       
    127|       await expect(cacheService.delete('any:key')).resolves.not.toThroâ€¦

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[46/94]âŽ¯

 FAIL  src/__tests__/unit/services/CacheService.test.ts > CacheService > ttl > should return TTL for existing key
TypeError: Cannot read properties of null (reading 'ttl')
 â¯ src/__tests__/unit/services/CacheService.test.ts:136:17
    134|   describe('ttl', () => {
    135|     test('should return TTL for existing key', async () => {
    136|       mockRedis.ttl.mockResolvedValue(60);
       |                 ^
    137|       
    138|       const result = await cacheService.ttl('player:123');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[47/94]âŽ¯

 FAIL  src/__tests__/unit/services/CacheService.test.ts > CacheService > ttl > should return -1 on error
TypeError: Cannot read properties of null (reading 'ttl')
 â¯ src/__tests__/unit/services/CacheService.test.ts:146:17
    144|     test('should return -1 on error', async () => {
    145|       const consoleSpy = vi.spyOn(console, 'error').mockImplementationâ€¦
    146|       mockRedis.ttl.mockRejectedValue(new Error('Redis TTL failed'));
       |                 ^
    147|       
    148|       const result = await cacheService.ttl('any:key');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[48/94]âŽ¯

 FAIL  src/__tests__/unit/services/CacheService.test.ts > CacheService > exists > should return true for existing key
TypeError: Cannot read properties of null (reading 'exists')
 â¯ src/__tests__/unit/services/CacheService.test.ts:159:17
    157|   describe('exists', () => {
    158|     test('should return true for existing key', async () => {
    159|       mockRedis.exists.mockResolvedValue(1);
       |                 ^
    160|       
    161|       const result = await cacheService.exists('player:123');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[49/94]âŽ¯

 FAIL  src/__tests__/unit/services/CacheService.test.ts > CacheService > exists > should return false for non-existing key
TypeError: Cannot read properties of null (reading 'exists')
 â¯ src/__tests__/unit/services/CacheService.test.ts:168:17
    166| 
    167|     test('should return false for non-existing key', async () => {
    168|       mockRedis.exists.mockResolvedValue(0);
       |                 ^
    169|       
    170|       const result = await cacheService.exists('player:nonexistent');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[50/94]âŽ¯

 FAIL  src/__tests__/unit/services/CacheService.test.ts > CacheService > exists > should return false on error
TypeError: Cannot read properties of null (reading 'exists')
 â¯ src/__tests__/unit/services/CacheService.test.ts:177:17
    175|     test('should return false on error', async () => {
    176|       const consoleSpy = vi.spyOn(console, 'error').mockImplementationâ€¦
    177|       mockRedis.exists.mockRejectedValue(new Error('Redis exists faileâ€¦
       |                 ^
    178|       
    179|       const result = await cacheService.exists('any:key');

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[51/94]âŽ¯

 FAIL  src/__tests__/unit/services/CacheService.test.ts > CacheService > disconnect > should disconnect from Redis
TypeError: Cannot read properties of null (reading 'quit')
 â¯ src/__tests__/unit/services/CacheService.test.ts:190:17
    188|   describe('disconnect', () => {
    189|     test('should disconnect from Redis', async () => {
    190|       mockRedis.quit.mockResolvedValue('OK');
       |                 ^
    191|       
    192|       await cacheService.disconnect();

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[52/94]âŽ¯

 FAIL  src/__tests__/unit/services/CharacterService.test.ts > CharacterService > getCharactersByAccount > should return characters from cache when available
AssertionError: expected '[{"id":"f9caaa25-9c70-4044-b75a-4690eâ€¦' to deeply equal [ { â€¦(44) }, { â€¦(44) } ]

[32m- Expected:[39m 
[
  {
    "accountId": "test-account-id",
    "appearance": {
      "build": 50,
      "eyeColor": "#0000FF",
      "faceType": "normal",
      "features": {},
      "hairColor": "#8B4513",
      "hairStyle": "1",
      "height": 50,
      "skinTone": "1",
    },
    "bankSlots": 20,
    "baseCharisma": 10,
    "baseConstitution": 10,
    "baseDexterity": 10,
    "baseIntelligence": 10,
    "baseStrength": 10,
    "baseWisdom": 10,
    "bonusCharisma": 0,
    "bonusConstitution": 0,
    "bonusDexterity": 0,
    "bonusIntelligence": 0,
    "bonusStrength": 0,
    "bonusWisdom": 0,
    "charismaTier": 0,
    "class": "warrior",
    "constitutionTier": 0,
    "createdAt": 2025-07-09T00:19:05.829Z,
    "currentHp": 100,
    "currentMp": 100,
    "currentStamina": 100,
    "currentZone": "starter_zone",
    "dexterityTier": 0,
    "experience": 0,
    "gender": "male",
    "gold": 100,
    "id": "f9caaa25-9c70-4044-b75a-4690ed8870ba",
    "intelligenceTier": 0,
    "isDeleted": false,
    "lastPlayedAt": null,
    "level": 1,
    "maxHp": 100,
    "maxMp": 100,
    "maxStamina": 100,
    "name": "TestCharacter1752020345828_0",
    "paragonDistribution": {},
    "paragonPoints": 0,
    "position": {
      "x": 0,
      "y": 0,
      "z": 0,
    },
    "prestigeLevel": 0,
    "race": "human",
    "strengthTier": 0,
    "updatedAt": 2025-07-09T00:19:05.829Z,
    "wisdomTier": 0,
  },
  {
    "accountId": "test-account-id",
    "appearance": {
      "build": 50,
      "eyeColor": "#0000FF",
      "faceType": "normal",
      "features": {},
      "hairColor": "#8B4513",
      "hairStyle": "1",
      "height": 50,
      "skinTone": "1",
    },
    "bankSlots": 20,
    "baseCharisma": 10,
    "baseConstitution": 10,
    "baseDexterity": 10,
    "baseIntelligence": 10,
    "baseStrength": 10,
    "baseWisdom": 10,
    "bonusCharisma": 0,
    "bonusConstitution": 0,
    "bonusDexterity": 0,
    "bonusIntelligence": 0,
    "bonusStrength": 0,
    "bonusWisdom": 0,
    "charismaTier": 0,
    "class": "warrior",
    "constitutionTier": 0,
    "createdAt": 2025-07-09T00:19:05.829Z,
    "currentHp": 100,
    "currentMp": 100,
    "currentStamina": 100,
    "currentZone": "starter_zone",
    "dexterityTier": 0,
    "experience": 0,
    "gender": "male",
    "gold": 100,
    "id": "9fa0e51b-0c5b-4739-b0c2-7171f2f3a5ab",
    "intelligenceTier": 0,
    "isDeleted": false,
    "lastPlayedAt": null,
    "level": 1,
    "maxHp": 100,
    "maxMp": 100,
    "maxStamina": 100,
    "name": "TestCharacter1752020345829_1",
    "paragonDistribution": {},
    "paragonPoints": 0,
    "position": {
      "x": 0,
      "y": 0,
      "z": 0,
    },
    "prestigeLevel": 0,
    "race": "human",
    "strengthTier": 0,
    "updatedAt": 2025-07-09T00:19:05.829Z,
    "wisdomTier": 0,
  },
]

[31m+ Received:[39m 
"[{\"id\":\"f9caaa25-9c70-4044-b75a-4690ed8870ba\",\"accountId\":\"test-account-id\",\"name\":\"TestCharacter1752020345828_0\",\"race\":\"human\",\"class\":\"warrior\",\"gender\":\"male\",\"level\":1,\"experience\":0,\"baseStrength\":10,\"baseDexterity\":10,\"baseIntelligence\":10,\"baseWisdom\":10,\"baseConstitution\":10,\"baseCharisma\":10,\"strengthTier\":0,\"dexterityTier\":0,\"intelligenceTier\":0,\"wisdomTier\":0,\"constitutionTier\":0,\"charismaTier\":0,\"bonusStrength\":0,\"bonusDexterity\":0,\"bonusIntelligence\":0,\"bonusWisdom\":0,\"bonusConstitution\":0,\"bonusCharisma\":0,\"prestigeLevel\":0,\"paragonPoints\":0,\"paragonDistribution\":{},\"currentHp\":100,\"maxHp\":100,\"currentMp\":100,\"maxMp\":100,\"currentStamina\":100,\"maxStamina\":100,\"gold\":100,\"bankSlots\":20,\"appearance\":{\"skinTone\":\"1\",\"hairStyle\":\"1\",\"hairColor\":\"#8B4513\",\"eyeColor\":\"#0000FF\",\"height\":50,\"build\":50,\"faceType\":\"normal\",\"features\":{}},\"currentZone\":\"starter_zone\",\"position\":{\"x\":0,\"y\":0,\"z\":0},\"isDeleted\":false,\"lastPlayedAt\":null,\"createdAt\":\"2025-07-09T00:19:05.829Z\",\"updatedAt\":\"2025-07-09T00:19:05.829Z\"},{\"id\":\"9fa0e51b-0c5b-4739-b0c2-7171f2f3a5ab\",\"accountId\":\"test-account-id\",\"name\":\"TestCharacter1752020345829_1\",\"race\":\"human\",\"class\":\"warrior\",\"gender\":\"male\",\"level\":1,\"experience\":0,\"baseStrength\":10,\"baseDexterity\":10,\"baseIntelligence\":10,\"baseWisdom\":10,\"baseConstitution\":10,\"baseCharisma\":10,\"strengthTier\":0,\"dexterityTier\":0,\"intelligenceTier\":0,\"wisdomTier\":0,\"constitutionTier\":0,\"charismaTier\":0,\"bonusStrength\":0,\"bonusDexterity\":0,\"bonusIntelligence\":0,\"bonusWisdom\":0,\"bonusConstitution\":0,\"bonusCharisma\":0,\"prestigeLevel\":0,\"paragonPoints\":0,\"paragonDistribution\":{},\"currentHp\":100,\"maxHp\":100,\"currentMp\":100,\"maxMp\":100,\"currentStamina\":100,\"maxStamina\":100,\"gold\":100,\"bankSlots\":20,\"appearance\":{\"skinTone\":\"1\",\"hairStyle\":\"1\",\"hairColor\":\"#8B4513\",\"eyeColor\":\"#0000FF\",\"height\":50,\"build\":50,\"faceType\":\"normal\",\"features\":{}},\"currentZone\":\"starter_zone\",\"position\":{\"x\":0,\"y\":0,\"z\":0},\"isDeleted\":false,\"lastPlayedAt\":null,\"createdAt\":\"2025-07-09T00:19:05.829Z\",\"updatedAt\":\"2025-07-09T00:19:05.829Z\"}]"

 â¯ src/__tests__/unit/services/CharacterService.test.ts:79:22
     77|       const result = await characterService.getCharactersByAccount(accâ€¦
     78|       
     79|       expect(result).toEqual(cachedCharacters);
       |                      ^
     80|       expect(mockCacheService.get).toHaveBeenCalledWith(`characters:acâ€¦
     81|       expect(mockCharacterRepository.findByAccountId).not.toHaveBeenCaâ€¦

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[53/94]âŽ¯

 FAIL  src/__tests__/unit/services/CharacterService.test.ts > CharacterService > getCharactersByAccount > should fetch from repository when not cached
AssertionError: expected "spy" to be called with arguments: [ â€¦(3) ][90m

Number of calls: [1m0[22m
[39m
 â¯ src/__tests__/unit/services/CharacterService.test.ts:93:43
     91|       expect(result).toEqual(characters);
     92|       expect(mockCharacterRepository.findByAccountId).toHaveBeenCalledâ€¦
     93|       expect(mockCacheService.setWithTTL).toHaveBeenCalledWith(
       |                                           ^
     94|         `characters:account:${accountId}`,
     95|         JSON.stringify(characters),

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[54/94]âŽ¯

 FAIL  src/__tests__/unit/services/CharacterService.test.ts > CharacterService > getCharactersByAccount > should return empty array when user has no characters
AssertionError: expected "spy" to be called at least once
 â¯ src/__tests__/unit/services/CharacterService.test.ts:107:43
    105|       
    106|       expect(result).toEqual([]);
    107|       expect(mockCacheService.setWithTTL).toHaveBeenCalled();
       |                                           ^
    108|     });
    109|     

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[55/94]âŽ¯

 FAIL  src/__tests__/unit/services/CharacterService.test.ts > CharacterService > getCharactersByAccount > should handle cache errors gracefully
Error: Cache error
 â¯ src/__tests__/unit/services/CharacterService.test.ts:112:50
    110|     it('should handle cache errors gracefully', async () => {
    111|       const characters = characterFactory.buildMany(2, { accountId });
    112|       mockCacheService.get.mockRejectedValueOnce(new Error('Cache erroâ€¦
       |                                                  ^
    113|       mockCharacterRepository.findByAccountId.mockResolvedValueOnce(châ€¦
    114|       

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[56/94]âŽ¯

 FAIL  src/__tests__/unit/services/CharacterService.test.ts > CharacterService > getCharacterWithStats > should return character with calculated stats
AssertionError: expected { character: { â€¦(44) }, â€¦(1) } to deeply equal { character: { â€¦(44) }, â€¦(1) }

[32m- Expected[39m
[31m+ Received[39m

[33m@@ -56,11 +56,7 @@[39m
[2m      "race": "human",[22m
[2m      "strengthTier": 0,[22m
[2m      "updatedAt": 2025-07-09T00:19:05.869Z,[22m
[2m      "wisdomTier": 0,[22m
[2m    },[22m
[32m-   "stats": {[39m
[32m-     "totalAttackPower": 50,[39m
[32m-     "totalDefense": 30,[39m
[32m-     "totalStrength": 25,[39m
[32m-   },[39m
[31m+   "derivedStats": undefined,[39m
[2m  }[22m

 â¯ src/__tests__/unit/services/CharacterService.test.ts:138:22
    136|       const result = await characterService.getCharacterWithStats(charâ€¦
    137|       
    138|       expect(result).toEqual({
       |                      ^
    139|         character,
    140|         stats: calculatedStats

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[57/94]âŽ¯

 FAIL  src/__tests__/unit/services/CharacterService.test.ts > CharacterService > getCharacterWithStats > should cache character data
AssertionError: expected "spy" to be called with arguments: [ 'character:test-character-id', â€¦(2) ][90m

Number of calls: [1m0[22m
[39m
 â¯ src/__tests__/unit/services/CharacterService.test.ts:163:43
    161|       await characterService.getCharacterWithStats(characterId);
    162|       
    163|       expect(mockCacheService.setWithTTL).toHaveBeenCalledWith(
       |                                           ^
    164|         `character:${characterId}`,
    165|         JSON.stringify(character),

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[58/94]âŽ¯

 FAIL  src/__tests__/unit/services/CharacterService.test.ts > CharacterService > createCharacter > should create character successfully
TypeError: this.characterRepo.isNameTaken is not a function
 â¯ CharacterService.createCharacter src/services/CharacterService.ts:21:50
     19|   async createCharacter(accountId: string, data: CreateCharacterDTO): â€¦
     20|     // Validate character name availability
     21|     const isNameTaken = await this.characterRepo.isNameTaken(data.nameâ€¦
       |                                                  ^
     22|     if (isNameTaken) {
     23|       throw new Error(`Character name "${data.name}" is already taken`â€¦
 â¯ src/__tests__/unit/services/CharacterService.test.ts:196:45

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[59/94]âŽ¯

 FAIL  src/__tests__/unit/services/CharacterService.test.ts > CharacterService > createCharacter > should throw error when character limit reached
AssertionError: expected 'this.characterRepo.isNameTaken is notâ€¦' to contain 'Maximum character limit reached'

Expected: [32m"[7mMaximum [27mcharacter[7m limit reached[27m"[39m
Received: [31m"[7mthis.[27mcharacter[7mRepo.isNameTaken is not a function[27m"[39m

 â¯ Module.expectAsyncThrows src/__tests__/helpers/assertions.ts:123:30
    121|   if (errorMessage) {
    122|     if (typeof errorMessage === 'string') {
    123|       expect(error!.message).toContain(errorMessage);
       |                              ^
    124|     } else {
    125|       expect(error!.message).toMatch(errorMessage);
 â¯ src/__tests__/unit/services/CharacterService.test.ts:219:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[60/94]âŽ¯

 FAIL  src/__tests__/unit/services/CharacterService.test.ts > CharacterService > createCharacter > should throw error when name already exists
AssertionError: expected 'this.characterRepo.isNameTaken is notâ€¦' to contain 'Character name already exists'

Expected: [32m"[7mC[27mharacter[7m name already exists[27m"[39m
Received: [31m"[7mthis.c[27mharacter[7mRepo.isNameTaken is not a function[27m"[39m

 â¯ Module.expectAsyncThrows src/__tests__/helpers/assertions.ts:123:30
    121|   if (errorMessage) {
    122|     if (typeof errorMessage === 'string') {
    123|       expect(error!.message).toContain(errorMessage);
       |                              ^
    124|     } else {
    125|       expect(error!.message).toMatch(errorMessage);
 â¯ src/__tests__/unit/services/CharacterService.test.ts:231:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[61/94]âŽ¯

 FAIL  src/__tests__/unit/services/CharacterService.test.ts > CharacterService > createCharacter > should validate character name format
AssertionError: expected 'this.characterRepo.isNameTaken is notâ€¦' to match /Invalid character name/

[32m- Expected:[39m 
/Invalid character name/

[31m+ Received:[39m 
"this.characterRepo.isNameTaken is not a function"

 â¯ Module.expectAsyncThrows src/__tests__/helpers/assertions.ts:125:30
    123|       expect(error!.message).toContain(errorMessage);
    124|     } else {
    125|       expect(error!.message).toMatch(errorMessage);
       |                              ^
    126|     }
    127|   }
 â¯ src/__tests__/unit/services/CharacterService.test.ts:252:9

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[62/94]âŽ¯

 FAIL  src/__tests__/unit/services/CharacterService.test.ts > CharacterService > createCharacter > should set initial stats based on race and class
TypeError: this.characterRepo.isNameTaken is not a function
 â¯ CharacterService.createCharacter src/services/CharacterService.ts:21:50
     19|   async createCharacter(accountId: string, data: CreateCharacterDTO): â€¦
     20|     // Validate character name availability
     21|     const isNameTaken = await this.characterRepo.isNameTaken(data.nameâ€¦
       |                                                  ^
     22|     if (isNameTaken) {
     23|       throw new Error(`Character name "${data.name}" is already taken`â€¦
 â¯ src/__tests__/unit/services/CharacterService.test.ts:266:30

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[63/94]âŽ¯

 FAIL  src/__tests__/unit/services/CharacterService.test.ts > CharacterService > deleteCharacter > should delete character successfully
TypeError: this.characterRepo.softDelete is not a function
 â¯ CharacterService.deleteCharacter src/services/CharacterService.ts:116:46
    114|     }
    115| 
    116|     const success = await this.characterRepo.softDelete(id);
       |                                              ^
    117|     
    118|     if (success) {
 â¯ src/__tests__/unit/services/CharacterService.test.ts:287:22

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[64/94]âŽ¯

 FAIL  src/__tests__/unit/services/CharacterService.test.ts > CharacterService > updateCharacterPosition > should update position successfully
TypeError: characterService.updateCharacterPosition is not a function
 â¯ src/__tests__/unit/services/CharacterService.test.ts:339:45
    337|       mockCharacterRepository.update.mockResolvedValueOnce(updatedCharâ€¦
    338|       
    339|       const result = await characterService.updateCharacterPosition(
       |                                             ^
    340|         characterId,
    341|         accountId,

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[65/94]âŽ¯

 FAIL  src/__tests__/unit/services/CharacterService.test.ts > CharacterService > updateCharacterPosition > should handle character not found
TypeError: characterService.updateCharacterPosition is not a function
 â¯ src/__tests__/unit/services/CharacterService.test.ts:360:45
    358|       mockCharacterRepository.findById.mockResolvedValueOnce(null);
    359|       
    360|       const result = await characterService.updateCharacterPosition(
       |                                             ^
    361|         characterId,
    362|         accountId,

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[66/94]âŽ¯

 FAIL  src/__tests__/unit/services/CharacterService.test.ts > CharacterService > updateCharacterPosition > should handle unauthorized access
TypeError: characterService.updateCharacterPosition is not a function
 â¯ src/__tests__/unit/services/CharacterService.test.ts:380:45
    378|       mockCharacterRepository.findById.mockResolvedValueOnce(characterâ€¦
    379|       
    380|       const result = await characterService.updateCharacterPosition(
       |                                             ^
    381|         characterId,
    382|         accountId,

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[67/94]âŽ¯

 FAIL  src/__tests__/unit/services/TutorialService.test.ts > MockTutorialService > getAllQuests > should include proper quest structure
AssertionError: expected undefined to be true // Object.is equality

[32m- Expected:[39m 
true

[31m+ Received:[39m 
undefined

 â¯ src/__tests__/unit/services/TutorialService.test.ts:91:38
     89|       
     90|       expect(firstQuest.name).toBe('First Steps');
     91|       expect(firstQuest.isMainQuest).toBe(true);
       |                                      ^
     92|       expect(firstQuest.difficulty).toBe(TutorialQuestDifficulty.BEGINâ€¦
     93|       expect(firstQuest.steps).toHaveLength(3);

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[68/94]âŽ¯

 FAIL  src/__tests__/unit/services/TutorialService.test.ts > MockTutorialService > updateProgress > should update tutorial progress successfully
TypeError: Cannot read properties of undefined (reading 'MEDIUM')
 â¯ MockTutorialService.getGuidance src/services/mock/MockTutorialService.ts:152:32
    150|       hints: currentStep.hints,
    151|       npcToTalk: currentStep.targetNPC,
    152|       urgency: TutorialUrgency.MEDIUM
       |                                ^
    153|     };
    154|   }
 â¯ MockTutorialService.updateProgress src/services/mock/MockTutorialService.ts:104:22
 â¯ src/__tests__/unit/services/TutorialService.test.ts:119:22

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[69/94]âŽ¯

 FAIL  src/__tests__/unit/services/TutorialService.test.ts > MockTutorialService > updateProgress > should complete quest when reaching final step
TypeError: Cannot read properties of undefined (reading 'MEDIUM')
 â¯ MockTutorialService.getGuidance src/services/mock/MockTutorialService.ts:152:32
    150|       hints: currentStep.hints,
    151|       npcToTalk: currentStep.targetNPC,
    152|       urgency: TutorialUrgency.MEDIUM
       |                                ^
    153|     };
    154|   }
 â¯ MockTutorialService.updateProgress src/services/mock/MockTutorialService.ts:104:22
 â¯ src/__tests__/unit/services/TutorialService.test.ts:136:22

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[70/94]âŽ¯

 FAIL  src/__tests__/unit/services/TutorialService.test.ts > MockTutorialService > updateProgress > should complete entire tutorial after all quests
TypeError: Cannot read properties of undefined (reading 'MEDIUM')
 â¯ MockTutorialService.getGuidance src/services/mock/MockTutorialService.ts:152:32
    150|       hints: currentStep.hints,
    151|       npcToTalk: currentStep.targetNPC,
    152|       urgency: TutorialUrgency.MEDIUM
       |                                ^
    153|     };
    154|   }
 â¯ MockTutorialService.updateProgress src/services/mock/MockTutorialService.ts:104:22
 â¯ src/__tests__/unit/services/TutorialService.test.ts:151:7

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[71/94]âŽ¯

 FAIL  src/__tests__/unit/services/TutorialService.test.ts > MockTutorialService > getGuidance > should return guidance for character in progress
TypeError: Cannot read properties of undefined (reading 'MEDIUM')
 â¯ MockTutorialService.getGuidance src/services/mock/MockTutorialService.ts:152:32
    150|       hints: currentStep.hints,
    151|       npcToTalk: currentStep.targetNPC,
    152|       urgency: TutorialUrgency.MEDIUM
       |                                ^
    153|     };
    154|   }
 â¯ src/__tests__/unit/services/TutorialService.test.ts:200:24

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[72/94]âŽ¯

 FAIL  src/__tests__/unit/services/TutorialService.test.ts > MockTutorialService > getGuidance > should return completion guidance for finished tutorial
TypeError: Cannot read properties of undefined (reading 'MEDIUM')
 â¯ MockTutorialService.getGuidance src/services/mock/MockTutorialService.ts:152:32
    150|       hints: currentStep.hints,
    151|       npcToTalk: currentStep.targetNPC,
    152|       urgency: TutorialUrgency.MEDIUM
       |                                ^
    153|     };
    154|   }
 â¯ src/__tests__/unit/services/TutorialService.test.ts:221:24

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[73/94]âŽ¯

 FAIL  src/__tests__/unit/services/TutorialService.test.ts > MockTutorialService > getGuidance > should return default guidance for new character
TypeError: Cannot read properties of undefined (reading 'MEDIUM')
 â¯ MockTutorialService.getGuidance src/services/mock/MockTutorialService.ts:152:32
    150|       hints: currentStep.hints,
    151|       npcToTalk: currentStep.targetNPC,
    152|       urgency: TutorialUrgency.MEDIUM
       |                                ^
    153|     };
    154|   }
 â¯ src/__tests__/unit/services/TutorialService.test.ts:230:24

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[74/94]âŽ¯

 FAIL  src/__tests__/unit/services/TutorialService.test.ts > MockTutorialService > Error Handling > should handle missing character ID gracefully
TypeError: Cannot read properties of undefined (reading 'MEDIUM')
 â¯ MockTutorialService.getGuidance src/services/mock/MockTutorialService.ts:152:32
    150|       hints: currentStep.hints,
    151|       npcToTalk: currentStep.targetNPC,
    152|       urgency: TutorialUrgency.MEDIUM
       |                                ^
    153|     };
    154|   }
 â¯ src/__tests__/unit/services/TutorialService.test.ts:306:24

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[75/94]âŽ¯

 FAIL  src/__tests__/unit/services/TutorialService.test.ts > MockTutorialService > Mock Data Validation > should have valid reward types
TypeError: actual value must be number or bigint, received "undefined"
 â¯ src/__tests__/unit/services/TutorialService.test.ts:351:35
    349|         quest.rewards.forEach(reward => {
    350|           expect(Object.values(TutorialRewardType)).toContain(reward.tâ€¦
    351|           expect(reward.quantity).toBeGreaterThan(0);
       |                                   ^
    352|           expect(reward.description).toBeDefined();
    353|         });
 â¯ src/__tests__/unit/services/TutorialService.test.ts:349:23
 â¯ src/__tests__/unit/services/TutorialService.test.ts:348:14

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[76/94]âŽ¯

 FAIL  src/providers/__tests__/integration/ErrorScenarios.test.ts > Service Provider Error Scenarios > Service Registration Errors > should handle null service registration
Error: Service NullService not registered. Available services: MonsterService, NPCService, DeathService, LootService, CombatService, BankService, CurrencyService, DialogueService, SpawnService, ZoneService, MovementService, ProgressionService, TutorialService, AffinityService, NullService
 â¯ Function.get src/providers/ServiceProvider.ts:34:13
     32|       const availableServices = Array.from(globalServices.keys()).joinâ€¦
     33|       logger.error(`Service ${name} not registered. Available servicesâ€¦
     34|       throw new Error(`Service ${name} not registered. Available serviâ€¦
       |             ^
     35|     }
     36|     return service as T;
 â¯ src/providers/__tests__/integration/ErrorScenarios.test.ts:38:32

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[77/94]âŽ¯

 FAIL  src/providers/__tests__/integration/ErrorScenarios.test.ts > Service Provider Error Scenarios > Monster Service Error Scenarios > should handle killing non-existent monster
AssertionError: promise rejected "Error: Monster non-existent-id not found" instead of resolving
 â¯ src/providers/__tests__/integration/ErrorScenarios.test.ts:80:7
     78|       await expect(
     79|         monsterService.killMonster('non-existent-id')
     80|       ).resolves.not.toThrow();
       |       ^
     81|     });
     82| 

Caused by: Error: Monster non-existent-id not found
 â¯ MockMonsterService.killMonster src/providers/mock/MockMonsterService.ts:340:13
 â¯ src/providers/__tests__/integration/ErrorScenarios.test.ts:79:24

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[78/94]âŽ¯

 FAIL  src/providers/__tests__/integration/ErrorScenarios.test.ts > Service Provider Error Scenarios > NPC Service Error Scenarios > should handle advancing non-existent dialogue
AssertionError: expected [Function] to throw error including 'Interaction non-existent-interaction â€¦' but got 'NPC non-existent-interaction not found'

Expected: [32m"[7mInteraction[27m non-existent-interaction not found"[39m
Received: [31m"[7mNPC[27m non-existent-interaction not found"[39m

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[79/94]âŽ¯

 FAIL  src/providers/__tests__/integration/ErrorScenarios.test.ts > Service Provider Error Scenarios > Bank Service Error Scenarios > should handle depositing to full bank
AssertionError: expected 'Item not found' to contain 'Bank is full'

Expected: [32m"Bank is full"[39m
Received: [31m"Item not found"[39m

 â¯ src/providers/__tests__/integration/ErrorScenarios.test.ts:188:30
    186|       
    187|       expect(result.success).toBe(false);
    188|       expect(result.message).toContain('Bank is full');
       |                              ^
    189|     });
    190| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[80/94]âŽ¯

 FAIL  src/providers/__tests__/integration/ErrorScenarios.test.ts > Service Provider Error Scenarios > Combat Service Error Scenarios > should handle actions on non-existent session
AssertionError: promise resolved "{ success: true, â€¦(3) }" instead of rejecting

[32m- Expected[39m
[31m+ Received[39m

[32m- Error {[39m
[32m-   "message": "rejected promise",[39m
[31m+ {[39m
[31m+   "combatEnded": false,[39m
[31m+   "message": "No active combat session",[39m
[31m+   "success": true,[39m
[31m+   "winner": undefined,[39m
[2m  }[22m

 â¯ src/providers/__tests__/integration/ErrorScenarios.test.ts:233:7
    231|           targetId: 'target'
    232|         })
    233|       ).rejects.toThrow();
       |       ^
    234|     });
    235| 

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[81/94]âŽ¯

 FAIL  src/providers/__tests__/integration/ErrorScenarios.test.ts > Service Provider Error Scenarios > Service Lifecycle Errors > should maintain service state after errors
AssertionError: expected 0 to be greater than 0
 â¯ src/providers/__tests__/integration/ErrorScenarios.test.ts:308:31
    306|       // Service should still be functional
    307|       const monsters = await monsterService.getMonstersInZone('starterâ€¦
    308|       expect(monsters.length).toBeGreaterThan(0);
       |                               ^
    309|     });
    310|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[82/94]âŽ¯

 FAIL  src/providers/__tests__/integration/ServiceProvider.integration.test.ts > ServiceProvider Integration Tests > Mock Services > should return mock data from services
AssertionError: expected 0 to be greater than 0
 â¯ src/providers/__tests__/integration/ServiceProvider.integration.test.ts:56:31
     54|       const monsterService = provider.get<IMonsterService>('MonsterSerâ€¦
     55|       const monsters = await monsterService.getMonstersInZone('starterâ€¦
     56|       expect(monsters.length).toBeGreaterThan(0);
       |                               ^
     57|       expect(monsters[0].id).toContain('mock-');
     58|       

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[83/94]âŽ¯

 FAIL  src/providers/__tests__/integration/ServiceProvider.integration.test.ts > ServiceProvider Integration Tests > Real Services > should use real service implementations
AssertionError: expected 'MockMonsterService' to be 'RealMonsterService' // Object.is equality

Expected: [32m"[7mReal[27mMonsterService"[39m
Received: [31m"[7mMock[27mMonsterService"[39m

 â¯ src/providers/__tests__/integration/ServiceProvider.integration.test.ts:124:47
    122|       
    123|       // Verify they are real service wrappers
    124|       expect(monsterService.constructor.name).toBe('RealMonsterServiceâ€¦
       |                                               ^
    125|       expect(npcService.constructor.name).toBe('RealNPCService');
    126|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[84/94]âŽ¯

 FAIL  src/providers/__tests__/integration/ServiceProvider.integration.test.ts > ServiceProvider Integration Tests > Service Switching > should switch between mock and real based on environment
AssertionError: expected 'MockMonsterService' to be 'RealMonsterService' // Object.is equality

Expected: [32m"[7mReal[27mMonsterService"[39m
Received: [31m"[7mMock[27mMonsterService"[39m

 â¯ src/providers/__tests__/integration/ServiceProvider.integration.test.ts:146:47
    144|       provider = ServiceProvider.getInstance();
    145|       monsterService = provider.get('MonsterService');
    146|       expect(monsterService.constructor.name).toBe('RealMonsterServiceâ€¦
       |                                               ^
    147|     });
    148|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[85/94]âŽ¯

 FAIL  src/providers/__tests__/mock/MockMonsterService.test.ts > MockMonsterService > getMonstersInZone > should return monsters for a valid zone
AssertionError: expected 0 to be greater than 0
 â¯ src/providers/__tests__/mock/MockMonsterService.test.ts:17:31
     15|       expect(monsters).toBeDefined();
     16|       expect(Array.isArray(monsters)).toBe(true);
     17|       expect(monsters.length).toBeGreaterThan(0);
       |                               ^
     18|       
     19|       // Verify monster structure

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[86/94]âŽ¯

 FAIL  src/providers/__tests__/mock/MockMonsterService.test.ts > MockMonsterService > getMonstersInZone > should return different monsters for different zones
TypeError: Cannot read properties of undefined (reading 'id')
 â¯ src/providers/__tests__/mock/MockMonsterService.test.ts:32:33
     30|       const forestMonsters = await service.getMonstersInZone('forest-zâ€¦
     31|       
     32|       expect(starterMonsters[0].id).not.toBe(forestMonsters[0].id);
       |                                 ^
     33|       expect(starterMonsters[0].name).not.toBe(forestMonsters[0].name);
     34|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[87/94]âŽ¯

 FAIL  src/providers/__tests__/mock/MockMonsterService.test.ts > MockMonsterService > spawnMonster > should add spawned monster to the zone
AssertionError: expected +0 to be 1 // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- 1[39m
[31m+ 0[39m

 â¯ src/providers/__tests__/mock/MockMonsterService.test.ts:59:38
     57|       
     58|       const updatedMonsters = await service.getMonstersInZone('starterâ€¦
     59|       expect(updatedMonsters.length).toBe(initialCount + 1);
       |                                      ^
     60|     });
     61|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[88/94]âŽ¯

 FAIL  src/providers/__tests__/mock/MockMonsterService.test.ts > MockMonsterService > updateMonsterState > should update monster state
TypeError: Cannot read properties of undefined (reading 'id')
 â¯ src/providers/__tests__/mock/MockMonsterService.test.ts:66:37
     64|     it('should update monster state', async () => {
     65|       const monsters = await service.getMonstersInZone('starter-zone');
     66|       const monsterId = monsters[0].id;
       |                                     ^
     67|       
     68|       const updatedMonster = await service.updateMonsterState(

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[89/94]âŽ¯

 FAIL  src/providers/__tests__/mock/MockMonsterService.test.ts > MockMonsterService > killMonster > should remove monster from the zone
TypeError: Cannot read properties of undefined (reading 'id')
 â¯ src/providers/__tests__/mock/MockMonsterService.test.ts:86:37
     84|     it('should remove monster from the zone', async () => {
     85|       const monsters = await service.getMonstersInZone('starter-zone');
     86|       const monsterId = monsters[0].id;
       |                                     ^
     87|       const initialCount = monsters.length;
     88|       

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[90/94]âŽ¯

 FAIL  src/providers/__tests__/mock/MockMonsterService.test.ts > MockMonsterService > killMonster > should not throw error for non-existent monster
AssertionError: promise rejected "Error: Monster non-existent not found" instead of resolving
 â¯ src/providers/__tests__/mock/MockMonsterService.test.ts:99:7
     97|       await expect(
     98|         service.killMonster('non-existent')
     99|       ).resolves.not.toThrow();
       |       ^
    100|     });
    101|   });

Caused by: Error: Monster non-existent not found
 â¯ MockMonsterService.killMonster src/providers/mock/MockMonsterService.ts:340:13
 â¯ src/providers/__tests__/mock/MockMonsterService.test.ts:98:17

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[91/94]âŽ¯

 FAIL  src/providers/__tests__/mock/MockMonsterService.test.ts > MockMonsterService > getMonsterTypes > should return list of monster types
AssertionError: expected { id: 'goblin', name: 'goblin', â€¦(8) } to have property "baseStats"
 â¯ src/providers/__tests__/mock/MockMonsterService.test.ts:115:20
    113|       expect(type).toHaveProperty('name');
    114|       expect(type).toHaveProperty('level');
    115|       expect(type).toHaveProperty('baseStats');
       |                    ^
    116|     });
    117|   });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[92/94]âŽ¯

 FAIL  src/providers/__tests__/mock/MockMonsterService.test.ts > MockMonsterService > getSpawnPoints > should return spawn points for a zone
TypeError: service.getSpawnPoints is not a function
 â¯ src/providers/__tests__/mock/MockMonsterService.test.ts:121:41
    119|   describe('getSpawnPoints', () => {
    120|     it('should return spawn points for a zone', async () => {
    121|       const spawnPoints = await service.getSpawnPoints('starter-zone');
       |                                         ^
    122|       
    123|       expect(spawnPoints).toBeDefined();

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[93/94]âŽ¯

 FAIL  src/providers/__tests__/mock/MockMonsterService.test.ts > MockMonsterService > getSpawnPoints > should return empty array for unknown zone
TypeError: service.getSpawnPoints is not a function
 â¯ src/providers/__tests__/mock/MockMonsterService.test.ts:135:41
    133| 
    134|     it('should return empty array for unknown zone', async () => {
    135|       const spawnPoints = await service.getSpawnPoints('unknown-zone');
       |                                         ^
    136|       expect(spawnPoints).toEqual([]);
    137|     });

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[94/94]âŽ¯

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯ Unhandled Errors âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯

Vitest caught 1 unhandled error during the test run.
This might cause false positive tests. Resolve unhandled errors to make sure your tests are not affected.

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯ Unhandled Error âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Error: Worker terminated due to reaching memory limit: JS heap out of memory
 â¯ [kOnExit] node:internal/worker:313:26
 â¯ Worker.<computed>.onexit node:internal/worker:229:20

âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯
Serialized Error: { code: 'ERR_WORKER_OUT_OF_MEMORY' }
âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯


 Test Files  13 failed | 12 passed (26)
      Tests  94 failed | 257 passed (366)
     Errors  1 error
   Start at  00:19:03
   Duration  46.46s (transform 2.37s, setup 627ms, collect 16.60s, tests 25.96s, environment 14ms, prepare 6.26s)

npm error Lifecycle script `test` failed with error:
npm error code 1
npm error path /home/runner/workspace/packages/server
npm error workspace @aeturnis/server@1.0.0
npm error location /home/runner/workspace/packages/server
npm error command failed
npm error command sh -c vitest run
