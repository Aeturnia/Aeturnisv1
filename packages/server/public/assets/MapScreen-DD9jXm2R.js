import{j as e}from"./query-vendor-VBf2NspY.js";import{r as n}from"./router-vendor-Cn6bChYk.js";import{c as $,b as C,a as P}from"./index-DUBnp2Sp.js";import"./react-vendor-BtP0CW_r.js";import"./gesture-vendor-CKK3uJth.js";const j=t=>{var r,i;return t.type==="city"?"town":t.type==="dungeon"?"dungeon":(r=t.features)!=null&&r.includes("boss")?"boss":(i=t.features)!=null&&i.includes("resources")?"resource":"town"};function R(){const[t,r]=n.useState(null),[i,x]=n.useState(1),[m,u]=n.useState({x:0,y:0}),[N,p]=n.useState(!0),[d,h]=n.useState(null),{zoneList:f,currentZone:o,getZones:y,getCharacterPosition:v,moveToZone:w}=$(),{currentCharacter:a}=C();n.useEffect(()=>{k()},[]),n.useEffect(()=>{o&&h({x:o.coordinates.x,y:o.coordinates.y})},[o]);const k=async()=>{try{if(p(!0),await y(),a!=null&&a.id){const s=await v(a.id);s&&h({x:s.coordinates.x,y:s.coordinates.y})}}catch(s){console.error("Failed to load map data:",s)}finally{p(!1)}},{gestureHandler:S,hapticFeedback:c}=P({onTap:({point:s})=>{c("light"),console.log("Map tap at:",s)},onPinch:({scale:s})=>{x(Math.max(.5,Math.min(3,s)))},onDrag:({movement:s})=>{u(l=>({x:l.x+s[0],y:l.y+s[1]}))}},{pinchZoomEnabled:!0,dragScrollEnabled:!0}),b=s=>{switch(j(s)){case"town":return"🏘️";case"dungeon":return"🕳️";case"boss":return"🐉";case"resource":return"⛏️";default:return"📍"}},L=s=>{if(s.locked)return"bg-gray-600";switch(j(s)){case"town":return"bg-blue-600";case"dungeon":return"bg-purple-600";case"boss":return"bg-red-600";case"resource":return"bg-yellow-600";default:return"bg-gray-600"}},Z=async s=>{if(!(!(a!=null&&a.id)||s.locked))try{await w(a.id,s.id),r(null),c("success")}catch(l){console.error("Failed to travel:",l),c("error")}};if(N)return e.jsx("div",{className:"h-full bg-dark-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl mb-4 animate-spin",children:"🗺️"}),e.jsx("p",{className:"text-white",children:"Loading world map..."})]})});const g=f?Array.from(f.values()):[];return e.jsxs("div",{className:"h-full bg-dark-900 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-4 left-4 right-4 z-20",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"card p-2",children:[e.jsx("h2",{className:"text-lg font-bold text-white",children:"World Map"}),e.jsxs("p",{className:"text-xs text-dark-400",children:[g.length," Zones Available"]})]}),e.jsx("div",{className:"flex space-x-2",children:e.jsx("button",{onClick:()=>{x(1),u({x:0,y:0}),c("light")},className:"btn-touch bg-dark-700 text-white rounded-lg px-3 py-2",children:"Reset View"})})]})}),e.jsxs("div",{className:"absolute inset-0 bg-gradient-to-br from-green-900/20 to-brown-900/20",style:{transform:`scale(${i}) translate(${m.x}px, ${m.y}px)`,transformOrigin:"center"},...S(),children:[e.jsxs("div",{className:"absolute inset-0 opacity-30",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1/3 bg-gradient-to-b from-gray-600 to-transparent"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-full h-1/3 bg-gradient-to-t from-green-600 to-transparent"}),e.jsx("div",{className:"absolute top-1/3 right-0 w-1/3 h-1/3 bg-gradient-to-l from-brown-600 to-transparent"})]}),g.map(s=>e.jsx("div",{className:`absolute w-12 h-12 rounded-full ${L(s)} 
              border-2 border-white shadow-lg cursor-pointer flex items-center justify-center`,style:{left:`${s.coordinates.x}%`,top:`${s.coordinates.y}%`,transform:"translate(-50%, -50%)",opacity:s.locked?.3:1},onClick:()=>{r(s),c("medium")},children:e.jsx("span",{className:"text-lg",children:b(s)})},s.id)),d&&e.jsx("div",{className:"absolute w-4 h-4 bg-primary-500 rounded-full border-2 border-white shadow-lg animate-pulse",style:{left:`${d.x}%`,top:`${d.y}%`,transform:"translate(-50%, -50%)"}})]}),e.jsxs("div",{className:"absolute bottom-4 left-4 card p-3 max-w-xs",children:[e.jsx("h3",{className:"text-sm font-semibold text-white mb-2",children:"Legend"}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-primary-500 rounded-full"}),e.jsx("span",{className:"text-dark-400",children:"Your Location"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-600 rounded-full"}),e.jsx("span",{className:"text-dark-400",children:"Town"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-purple-600 rounded-full"}),e.jsx("span",{className:"text-dark-400",children:"Dungeon"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-600 rounded-full"}),e.jsx("span",{className:"text-dark-400",children:"Boss"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-600 rounded-full"}),e.jsx("span",{className:"text-dark-400",children:"Completed"})]})]})]}),t&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",onClick:()=>r(null),children:e.jsxs("div",{className:"card p-6 max-w-sm w-full",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"text-4xl mb-2",children:b(t)}),e.jsx("h3",{className:"text-xl font-bold text-white",children:t.displayName}),e.jsxs("p",{className:"text-sm text-dark-400 capitalize",children:[t.levelRequirement&&`Level ${t.levelRequirement} `,t.type," Zone"]})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-400",children:"Status:"}),e.jsx("span",{className:`text-sm ${t.locked?"text-red-400":"text-green-400"}`,children:t.locked?"Locked":"Available"})]}),t.description&&e.jsxs("div",{className:"text-sm text-dark-400 italic",children:['"',t.description,'"']}),t.features&&t.features.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-dark-400 text-sm",children:"Features:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:t.features.map((s,l)=>e.jsx("span",{className:"px-2 py-1 bg-dark-700 rounded text-xs text-white capitalize",children:s},l))})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{className:"btn-touch btn-primary flex-1",disabled:t.locked||!a,onClick:()=>Z(t),children:t.locked?"Locked":"Travel"}),e.jsx("button",{className:"btn-touch btn-secondary",onClick:()=>r(null),children:"Close"})]})]})})]})}export{R as MapScreen};
